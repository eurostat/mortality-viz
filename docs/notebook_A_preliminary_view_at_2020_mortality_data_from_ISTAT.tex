\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    
    \usepackage{iftex}
    \ifPDFTeX
    	\usepackage[T1]{fontenc}
    	\usepackage{mathpazo}
    \else
    	\usepackage{fontspec}
    \fi

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}
    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range
    \makeatletter % fix for grffile with XeLaTeX
    \def\Gread@@xetex#1{%
      \IfFileExists{"\Gin@base".bb}%
      {\Gread@eps{\Gin@base.bb}}%
      {\Gread@@xetex@aux#1}%
    }
    \makeatother

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{ \textsf{01\_preliminary\_IT\_study} \\ --- \\ Notebook implementation of ~\\ \textit{"A preliminary view at 2020 mortality data from ISTAT"}} %01\_preliminary\_IT\_study}
   % \title{01\_preliminary\_IT\_study}
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb. 
    \makeatletter
        \newbox\Wrappedcontinuationbox 
        \newbox\Wrappedvisiblespacebox 
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}} 
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}} 
        \newcommand*\Wrappedcontinuationindent {3ex } 
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox} 
        % Take advantage of the already applied Pygments mark-up to insert 
        % potential linebreaks for TeX processing. 
        %        {, <, #, %, $, ' and ": go to next line. 
        %        _, }, ^, &, >, - and ~: stay at end of broken line. 
        % Use of \textquotesingle for straight quote. 
        \newcommand*\Wrappedbreaksatspecials {% 
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}% 
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}% 
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}% 
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}% 
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}% 
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}% 
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}% 
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}% 
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}% 
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}% 
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}% 
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}% 
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}% 
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}% 
        } 
        % Some characters . , ; ? ! / are not pygmentized. 
        % This macro makes them "active" and they will insert potential linebreaks 
        \newcommand*\Wrappedbreaksatpunct {% 
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}% 
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}% 
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}% 
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}% 
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}% 
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}% 
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}% 
            \catcode`\.\active
            \catcode`\,\active 
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active 
            \lccode`\~`\~ 	
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%
        
        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active 	
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}
    
    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        \ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    \renewcommand{\thesection}{}% Remove section references...
    \renewcommand{\thesubsection}{\arabic{subsection}}%... from subsections
    \date{}        

\begin{document}
    
    \maketitle
    
    
    \vspace*{-0.05\textheight}

    
    %\hypertarget{preliminary-study-of-early-2020-mortality-data-over-italy}{%
    %\subsection{Preliminary study of early-2020 mortality data over Italy}\label{preliminary-study-of-early-2020-mortality-data-over-italy}}

    This notebook aims at reproducing the original study by \textbf{F.
Ricciato (@Eurostat)} published on
\href{https://ec.europa.eu/eurostat/cros/content/preliminary-view-2020-mortality-data-istat}{CROS
portal} on \textbf{April 16th, 2020}.



\textbf{\emph{disclaimer}} :\\
The purpose of this notebook is mostly didactic. The data used when
running this notebook are fetched directly fetched from the provider
(\emph{ISTAT}) website. While they are always the latest
available/updated, they do no necessarily correspond to those used in
the original study. The methodological approach adopted here is purely
descriptive, it involves no statistical modelling. Note that the
methodology is actually not discussed in this notebook, refer to the
original publication to this aim. The notebook does not aim at
performance either, still it is generic enough to be repurposed for
different similar datasets as long as metadata are ``descriptive
enough''.

\textbf{Table of Contents}: 
\begin{itemize}
\item Section~\ref{setting-and-checking-the-environment-first}: Setting and checking the environment first.
\item Section~\ref{data-ingestion}: Data ingestion.
\item Section~\ref{data-preparation}: Data preparation.
\item Section~\ref{figure-1---map-of-anpr-municipalities-included-in-the-data-set}: Map of ANPR municipalities included in the data set (Figure~1). 
\item Section~\ref{figure-2---daily-and-cumulated-deaths-for-all-municipalities-in-the-data-set}: Daily and cumulated deaths for all municipalities in the data set  (Figure~2). 
\item Section~\ref{figure-3---age-distribution-of-total-deaths-in-the-period-15-21-march}: Age distribution of total deaths in the period 15-21 March  (Figure~3). 
\item Section~\ref{figure-4---relative-increment-of-2020-over-baseline-in-15-21-march-per-age-group}: Relative increment of 2020 over baseline in 15-21 March per age group  (Figure~4). 
\item Section~\ref{figure-5---empirical-cumulative-distribution-of-excess-deaths-in-15-21-march-2020-per-age-group}: Empirical cumulative distribution of excess deaths in 15-21 March 2020 per age group  (Figure~5). 
\item Section~\ref{figure-6---daily-and-cumulated-deaths-of-males-aged-65}: Daily and cumulated deaths of males aged 65+  (Figure~6). 
\item Section~\ref{figure-7---total-deaths-in-the-period-1-21-march-per-individual-municipalities}: Total deaths in the period 1-21 March per individual municipalities (Figure~7). 
\item Section~\ref{figures-8---12-daily-and-cumulative-deaths-over-individual-cities}: Daily and cumulative deaths over individual cities (Figures~8-12). 
\item Section~\ref{figure-13---total-deaths-in-the-week-15-21-march-by-groups-of-municipalities-within-the-same-province}: Total deaths in the week 15-21 March by groups of municipalities within the same
province  (Figure~13). 
\item Section~\ref{figures-14---16-daily-and-cumulative-deaths-over-individual-provinces}: Daily and cumulative deaths over individual provinces  (Figure~14-16).
\end{itemize}

\emph{note: cells need to be run sequentially!}

The study deals with early reports on the beginning of 2020 mortality in
Italy and is entitled:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{1}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{COUNTRY} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{IT}\PY{l+s+s2}{\PYZdq{}}
\PY{n}{YEAR} \PY{o}{=} \PY{l+m+mi}{2020}
\PY{n}{PROVIDER} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ISTAT}\PY{l+s+s2}{\PYZdq{}}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[1mA preliminary view at }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ mortality data from }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[0m}\PY{l+s+s1}{\PYZdq{}}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{YEAR}\PY{p}{,} \PY{n}{PROVIDER}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
"\textbf{A preliminary view at 2020 mortality data from ISTAT}"
    \end{Verbatim}

Concerning data extraction, while the latest available version of the
original study is from April 16th, please note:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{datetime} \PY{k+kn}{import} \PY{n}{datetime}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Last update/running of this notebook: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{datetime}\PY{o}{.}\PY{n}{today}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Last update/running of this notebook: \textbf{2020-05-07 01:03:40.424613}
    \end{Verbatim}

    \hypertarget{setting-and-checking-the-environment-first}{%
\subsection{Setting and checking the environment
first}\label{setting-and-checking-the-environment-first}}

    Let's run some setup necessary to import the dependency(ies) required to
run the project\ldots{} First, some generic packages, including a few to
handle date/time data since we deal with timeseries:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{os}\PY{o}{,} \PY{n+nn}{sys}
\PY{k+kn}{import} \PY{n+nn}{json}
\PY{k+kn}{import} \PY{n+nn}{time}
\PY{k+kn}{from} \PY{n+nn}{datetime} \PY{k+kn}{import} \PY{n}{timedelta} \PY{c+c1}{\PYZsh{} and datetime above}
\PY{k+kn}{import} \PY{n+nn}{calendar}
\end{Verbatim}
\end{tcolorbox}

    In the following, we will take care of setting the ready-to-run
environment even when libraries/packages are missing. This will ensure
you can always run this notebook, in particular on a remote platform
(\emph{e.g.}, \href{https://mybinder.org}{\texttt{binder}},
\href{https://colab.research.google.com/notebook}{\texttt{Google\ colab}},\ldots{}).
However, you should probably consider running this notebook in a virtual
environment (\texttt{conda\ -n\ env} or \texttt{virtualenv}) so as to
make these installs temporary and/or isolated.

Essential for the running of the notebook, besides the basic
\href{https://numpy.org}{\texttt{numpy}} package, is the
\href{https://pandas.pydata.org}{\texttt{pandas}} package use for common
data handling and processing:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k}{try}\PY{p}{:}
    \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\PY{k}{except} \PY{n+ne}{ImportError}\PY{p}{:}
    \PY{k}{try}\PY{p}{:}
        \PY{o}{!}\PY{o}{\PYZob{}}sys.executable\PY{o}{\PYZcb{}} \PYZhy{}m pip install pandas
    \PY{k}{except}\PY{p}{:}
        \PY{k}{raise} \PY{n+ne}{IOError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{!!! Sorry, you}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{re doomed, you won}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{t be able to run this notebook... !!!}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{! Package pandas installed on\PYZhy{}the\PYZhy{}fly !}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} \PYZpc{}\PYZpc{}bash \PYZsh{} testing google\PYZhy{}colab for instance}
\PY{c+c1}{\PYZsh{} [[ ! \PYZhy{}e /colabtools ]] \PYZam{}\PYZam{} exit}
\PY{c+c1}{\PYZsh{} `which python` \PYZhy{}m pip install pandas}
\end{Verbatim}
\end{tcolorbox}

    Note that the \href{https://geopandas.org}{\texttt{geopandas}} package
is also used as soon as basic `geoprocessing' (simple vector data
ingestion and map representation) is involved:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{try}\PY{p}{:}
    \PY{k+kn}{import} \PY{n+nn}{geopandas} \PY{k}{as} \PY{n+nn}{gpd}
\PY{k}{except} \PY{n+ne}{ImportError}\PY{p}{:}
    \PY{k}{try}\PY{p}{:}
        \PY{o}{!}\PY{o}{\PYZob{}}sys.executable\PY{o}{\PYZcb{}} \PYZhy{}m pip install geopandas
    \PY{k}{except}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{! Package geopandas not installed !}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{! Package geopandas installed on\PYZhy{}the\PYZhy{}fly !}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    You will also need to import the
\href{https://github.com/eurostat/pyEUDatNat}{\texttt{pyeudatnat}}
package that contains various useful functions/methods for
metadata-based data ingestion:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{try}\PY{p}{:}
    \PY{k+kn}{import} \PY{n+nn}{pyeudatnat}
\PY{k}{except} \PY{n+ne}{ImportError}\PY{p}{:}
    \PY{k}{try}\PY{p}{:}
        \PY{c+c1}{\PYZsh{} import google.colab}
        \PY{o}{!}\PY{o}{\PYZob{}}sys.executable\PY{o}{\PYZcb{}} \PYZhy{}m pip install git+https://github.com/eurostat/pyeudatnat.git
        \PY{c+c1}{\PYZsh{} !\PYZob{}sys.executable\PYZcb{} \PYZhy{}m pip install pyeudatnat}
    \PY{k}{except}\PY{p}{:}
        \PY{k}{raise} \PY{n+ne}{IOError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Sorry, you}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{re doomed: package pyeudatnat not installed !}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{! Package pyeudatnat installed on\PYZhy{}the\PYZhy{}fly !}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
        
\PY{k}{try}\PY{p}{:}
    \PY{k+kn}{from} \PY{n+nn}{pyeudatnat}\PY{n+nn}{.}\PY{n+nn}{base} \PY{k+kn}{import} \PY{n}{datnatFactory}
    \PY{k+kn}{from} \PY{n+nn}{pyeudatnat}\PY{n+nn}{.}\PY{n+nn}{misc} \PY{k+kn}{import} \PY{n}{Structure}
    \PY{k+kn}{from} \PY{n+nn}{pyeudatnat}\PY{n+nn}{.}\PY{n+nn}{misc} \PY{k+kn}{import} \PY{n}{Type}\PY{p}{,} \PY{n}{Datetime}
\PY{k}{except}\PY{p}{:}
    \PY{k}{pass}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
/Users/gjacopo/Developments/pyEUDatNat/pyeudatnat/geo.py:48: UserWarning:
! Missing happygisco package (https://github.com/eurostat/happyGISCO) - GISCO
web services not available !
  warnings.warn('\textbackslash{}n! Missing happygisco package
(https://github.com/eurostat/happyGISCO) - GISCO web services not available !')
    \end{Verbatim}

    Last, we will use the \href{https://matplotlib.org}{\texttt{matplotlib}}
package to render the various illustrations of the original study:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{try}\PY{p}{:}
    \PY{k+kn}{import} \PY{n+nn}{matplotlib}
\PY{k}{except} \PY{n+ne}{ImportError}\PY{p}{:}
    \PY{k}{raise} \PY{n+ne}{IOError}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Guess what: you}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{re doomed...}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{k}{else}\PY{p}{:}
    \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{mplt}
    \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{dates} \PY{k}{as} \PY{n+nn}{mdates}
    \PY{k+kn}{from} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{ticker} \PY{k+kn}{import} \PY{n}{FuncFormatter}\PY{p}{,} \PY{n}{MaxNLocator}\PY{p}{,} \PY{n}{IndexLocator}
\PY{k}{finally}\PY{p}{:}
    \PY{n}{\PYZus{}FIGSIZE\PYZus{}}\PY{p}{,} \PY{n}{\PYZus{}DPI\PYZus{}} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{7}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{140} \PY{c+c1}{\PYZsh{} just some default display size/resolution inside this notebook...}
\PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{data-ingestion}{%
\subsection{Data ingestion}\label{data-ingestion}}

    The ingestion of the data is entirely defined through the metadata (see
resources listed in the
\href{https://github.com/eurostat/losstat\#Data}{``Data resources''}
section), \emph{e.g.} information regarding source file location, format
(although this can be inferred), \emph{etc}\ldots{} in that case the
\texttt{JSON} file
\texttt{\textquotesingle{}ITmetadata.json\textquotesingle{}} contained
in this directory. If it does not exist, we download this file from the
\texttt{github} repository:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{THISDIR} \PY{o}{=} \PY{o}{!}pwd
\PY{n}{META} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{THISDIR}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ITmetadata.json}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{k}{try}\PY{p}{:}
    \PY{k}{assert} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{exists}\PY{p}{(}\PY{n}{META}\PY{p}{)}
\PY{k}{except}\PY{p}{:}
    \PY{o}{!}wget \PYZhy{}O \PY{n+nv}{\PYZdl{}META} https://raw.githubusercontent.com/gjacopo/morbstat/master/ITmetadata.json
\PY{k}{with} \PY{n+nb}{open}\PY{p}{(}\PY{n}{META}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{as} \PY{n}{fp}\PY{p}{:}
    \PY{n}{metadata} \PY{o}{=} \PY{n}{json}\PY{o}{.}\PY{n}{load}\PY{p}{(}\PY{n}{fp}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Content of the metadata file }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{basename}\PY{p}{(}\PY{n}{META}\PY{p}{)}\PY{p}{)}
\PY{n}{metadata}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Content of the metadata file 'ITmetadata.json':

    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\{'country': \{'code': 'IT', 'name': 'Italia'\},
 'lang': \{'code': 'it', 'name': 'italian'\},
 'file': 'comune\_giorno.csv',
 'fmt': 'csv',
 'source': 'https://www.istat.it/it/files/2020/03/comune-giorno.zip',
 'enc': 'latin1',
 'sep': ',',
 'datefmt': '\%m\%d',
 'index': \{'reg\_code': \{'name': 'REG',
   'desc': 'Codice Istat della Regione di residenza.',
   'type': 'int',
   'values': None\},
  'prov\_code': \{'name': 'PROV',
   'desc': 'Codice Istat della Provincia di residenza.',
   'type': 'int',
   'values': None\},
  'region': \{'name': 'NOME\_REGIONE',
   'desc': 'Regione di residenza.',
   'type': 'str',
   'values': None\},
  'province': \{'name': 'NOME\_PROVINCIA',
   'desc': 'Provincia di residenza.',
   'type': 'str',
   'values': None\},
  'city': \{'name': 'NOME\_COMUNE',
   'desc': 'Comune di residenza.',
   'type': 'str',
   'values': None\},
  'city\_code': \{'name': 'COD\_PROVCOM',
   'desc': 'Comune di residenza (classificazione Istat al 01/01/2020)',
   'type': 'str',
   'values': None\},
  'age': \{'name': 'CL\_ETA',
   'desc': 'Classe di età in anni compiuti al momento del decesso',
   'type': 'int',
   'values': \{'0': '0',
    '1': '1-4',
    '2': '5-9',
    '3': '10-14',
    '4': '15-19',
    '5': '20-24',
    '6': '25-29',
    '7': '30-34',
    '8': '35-39',
    '9': '40-44',
    '10': '45-49',
    '11': '50-54',
    '12': '55-59',
    '13': '60-64',
    '14': '65-69',
    '15': '70-74',
    '16': '75-79',
    '17': '80-84',
    '18': '85-89',
    '19': '90-94',
    '20': '95-99',
    '21': '100+'\}\},
  'date': \{'name': 'GE',
   'desc': 'Giorno di decesso (formato variabile: MeseMeseGiornoGiorno).',
   'type': 'str',
   'values': None\},
  'm\_15': \{'name': 'MASCHI\_15',
   'desc': 'numero di decessi maschili nel 2015.',
   'type': 'int',
   'values': None\},
  'm\_16': \{'name': 'MASCHI\_16',
   'desc': 'numero di decessi maschili nel 2016.',
   'type': 'int',
   'values': None\},
  'm\_17': \{'name': 'MASCHI\_17',
   'desc': 'numero di decessi maschili nel 2017.',
   'type': 'int',
   'values': None\},
  'm\_18': \{'name': 'MASCHI\_18',
   'desc': 'numero di decessi maschili nel 2018.',
   'type': 'int',
   'values': None\},
  'm\_19': \{'name': 'MASCHI\_19',
   'desc': 'numero di decessi maschili nel 2019.',
   'type': 'int',
   'values': None\},
  'm\_20': \{'name': 'MASCHI\_20',
   'desc': 'numero di decessi maschili nel 2020.',
   'type': 'int',
   'values': None\},
  'f\_15': \{'name': 'FEMMINE\_15',
   'desc': 'numero di decessi femminili nel 2015.',
   'type': 'int',
   'values': None\},
  'f\_16': \{'name': 'FEMMINE\_16',
   'desc': 'numero di decessi femminili nel 2016.',
   'type': 'int',
   'values': None\},
  'f\_17': \{'name': 'FEMMINE\_17',
   'desc': 'numero di decessi femminili nel 2017.',
   'type': 'int',
   'values': None\},
  'f\_18': \{'name': 'FEMMINE\_18',
   'desc': 'numero di decessi femminili nel 2018.',
   'type': 'int',
   'values': None\},
  'f\_19': \{'name': 'FEMMINE\_19',
   'desc': 'numero di decessi femminili nel 2019.',
   'type': 'int',
   'values': None\},
  'f\_20': \{'name': 'FEMMINE\_20',
   'desc': 'numero di decessi femminili nel 2020.',
   'type': 'int',
   'values': None\},
  't\_15': \{'name': 'TOTALE\_15',
   'desc': 'numero di decessi totali nel 2015.',
   'type': 'int',
   'values': None\},
  't\_16': \{'name': 'TOTALE\_16',
   'desc': 'numero di decessi totali nel 2016.',
   'type': 'int',
   'values': None\},
  't\_17': \{'name': 'TOTALE\_17',
   'desc': 'numero di decessi totali nel 2017.',
   'type': 'int',
   'values': None\},
  't\_18': \{'name': 'TOTALE\_18',
   'desc': 'numero di decessi totali nel 2018.',
   'type': 'int',
   'values': None\},
  't\_19': \{'name': 'TOTALE\_19',
   'desc': 'numero di decessi totali nel 2019.',
   'type': 'int',
   'values': None\},
  't\_20': \{'name': 'TOTALE\_20',
   'desc': 'numero di decessi totali nel 2020.',
   'type': 'int',
   'values': None\}\},
 'nan': 9999,
 'desc': 'Descrizione e tracciato record dati comunali giornalieri.docx'\}
\end{Verbatim}
\end{tcolorbox}
        
    Using the \texttt{datnatFactory} method, simply define the data
structure:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{MortDatIT} \PY{o}{=} \PY{n}{datnatFactory}\PY{p}{(}\PY{n}{country} \PY{o}{=} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{IT}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{dIT} \PY{o}{=} \PY{n}{MortDatIT}\PY{p}{(}\PY{n}{META}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Data source: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{ \PYZhy{} file: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{dIT}\PY{o}{.}\PY{n}{source}\PY{p}{,} \PY{n}{dIT}\PY{o}{.}\PY{n}{file}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Example of data field \PYZhy{} number of female deaths in 2016: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{f\PYZus{}16}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Data source: https://www.istat.it/it/files/2020/03/comune-giorno.zip - file:
\textcolor{ansi-blue-intense}{comune\_giorno.csv}
Example of data field - number of female deaths in 2016: \textcolor{ansi-blue-intense}{\{'name':
'FEMMINE\_16', 'desc': 'numero di decessi femminili nel 2016.', 'type': 'int',
'values': None\}}
    \end{Verbatim}

    Actually, we already define some metadata variables that we will use in
the remaining of this notebook (note that this info could be directly
inferred when ingesting the data without setting it directly into the
metadata file):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{FMT} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{fmt}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{o+ow}{or} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{file}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\PY{n}{ENC} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{enc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{k+kc}{None}\PY{p}{)} 
\PY{n}{SEP} \PY{o}{=}  \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sep}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{k+kc}{None}\PY{p}{)} 
\PY{n}{DTYPE} \PY{o}{=} \PY{p}{\PYZob{}}\PY{n}{v}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{:} \PY{n}{Type}\PY{o}{.}\PY{n}{upytname2npt}\PY{p}{(}\PY{n}{v}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)} \PY{k}{for} \PY{n}{v} \PY{o+ow}{in} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}\PY{p}{)}\PY{o}{.}\PY{n}{values}\PY{p}{(}\PY{p}{)}\PY{p}{\PYZcb{}}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Some basic metadata information: }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZhy{} field types: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{ }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZhy{} format: }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZhy{} encoding: }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ }\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{\PYZhy{} separator: }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{\PYZdq{}} 
      \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{DTYPE}\PY{p}{,}\PY{n}{FMT}\PY{p}{,}\PY{n}{ENC}\PY{p}{,}\PY{n}{SEP}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Some basic metadata information:
- field types: \{'REG': dtype('int64'), 'PROV': dtype('int64'), 'NOME\_REGIONE':
dtype('<U'), 'NOME\_PROVINCIA': dtype('<U'), 'NOME\_COMUNE': dtype('<U'),
'COD\_PROVCOM': dtype('<U'), 'CL\_ETA': dtype('int64'), 'GE': dtype('<U'),
'MASCHI\_15': dtype('int64'), 'MASCHI\_16': dtype('int64'), 'MASCHI\_17':
dtype('int64'), 'MASCHI\_18': dtype('int64'), 'MASCHI\_19': dtype('int64'),
'MASCHI\_20': dtype('int64'), 'FEMMINE\_15': dtype('int64'), 'FEMMINE\_16':
dtype('int64'), 'FEMMINE\_17': dtype('int64'), 'FEMMINE\_18': dtype('int64'),
'FEMMINE\_19': dtype('int64'), 'FEMMINE\_20': dtype('int64'), 'TOTALE\_15':
dtype('int64'), 'TOTALE\_16': dtype('int64'), 'TOTALE\_17': dtype('int64'),
'TOTALE\_18': dtype('int64'), 'TOTALE\_19': dtype('int64'), 'TOTALE\_20':
dtype('int64')\}
- format: 'csv'
- encoding: 'latin1'
- separator: ','
    \end{Verbatim}

    Let's now retrieve the data \emph{on-the-fly}. Hence everytime you
launch this notebook, the original data are collected from \emph{ISTAT}
website. The main advantage is that you will always get the
newest/latest available data, hence you will be able to update the
study. The main drawback is that \ldots{} you will use your bandwidth
everytime! Note however that the method \texttt{load\_data} also accepts
a \texttt{caching} parameter that enable use to load/save the data
from/to a cache. Note the purpose of this notebook, check the
implementation of the \texttt{pyeudatnat} package if interested.

Many ways to actually fetch the data, but we'd rather exploit the meta
information available above:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{12}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dIT}\PY{o}{.}\PY{n}{load\PYZus{}data}\PY{p}{(}\PY{n}{fmt} \PY{o}{=} \PY{n}{FMT}\PY{p}{,} \PY{n}{encoding} \PY{o}{=} \PY{n}{ENC}\PY{p}{,} \PY{n}{sep} \PY{o}{=} \PY{n}{SEP}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{n}{DTYPE}\PY{p}{)}
\PY{n+nb}{print} \PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Data extracted on }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{Datetime}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{n}{Datetime}\PY{o}{.}\PY{n}{TODAY}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{Y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Data extracted on 07/05/2020
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
/Users/gjacopo/Developments/pyEUDatNat/pyeudatnat/io.py:939: UserWarning:
! 'CSV' data loaded in dataframe !
  warnings.warn("\textbackslash{}n! '\%s' data loaded in dataframe !" \% f.upper())
    \end{Verbatim}

    Let's also simplify the work by broadcasting the dataset into a local
variable (not optimal though\ldots{}):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{data} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{data}     
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of records: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m \PYZhy{} Number of fields (columns): }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} 
      \PY{o}{\PYZpc{}} \PY{n}{data}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Number of records: \textbf{841031} - Number of fields (columns): \textbf{26}
    \end{Verbatim}

    Let's have a first look at the data:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{data}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
   REG  PROV NOME\_REGIONE NOME\_PROVINCIA NOME\_COMUNE COD\_PROVCOM  CL\_ETA  \textbackslash{}
0    1     1     Piemonte         Torino       Agliè      001001      17
1    1     1     Piemonte         Torino       Agliè      001001      18
2    1     1     Piemonte         Torino       Agliè      001001      18
3    1     1     Piemonte         Torino       Agliè      001001      17
4    1     1     Piemonte         Torino       Agliè      001001      18

     GE  MASCHI\_15  MASCHI\_16  {\ldots}  FEMMINE\_17  FEMMINE\_18  FEMMINE\_19  \textbackslash{}
0  0102          0          0  {\ldots}           0           1           0
1  0104          0          0  {\ldots}           0           0           0
2  0105          0          0  {\ldots}           0           0           0
3  0106          1          0  {\ldots}           0           0           0
4  0106          0          0  {\ldots}           0           0           0

   FEMMINE\_20  TOTALE\_15  TOTALE\_16  TOTALE\_17  TOTALE\_18  TOTALE\_19  \textbackslash{}
0           0          0          0          0          1          0
1           0          0          1          0          0          0
2           0          0          0          0          0          0
3           0          1          0          0          0          0
4           0          0          0          0          1          0

   TOTALE\_20
0          0
1          0
2          1
3          0
4          0

[5 rows x 26 columns]
\end{Verbatim}
\end{tcolorbox}
        
    What are the fields? It should be consistent with the \texttt{metadata}
file we introduced earlier\ldots{}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Fields of the data: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{list}\PY{p}{(}\PY{n}{data}\PY{o}{.}\PY{n}{columns}\PY{p}{)}\PY{p}{)}  
\PY{k}{try}\PY{p}{:}
    \PY{k}{assert} \PY{n+nb}{set}\PY{p}{(}\PY{n+nb}{list}\PY{p}{(}\PY{n}{data}\PY{o}{.}\PY{n}{columns}\PY{p}{)}\PY{p}{)} \PY{o}{==} \PY{n+nb}{set}\PY{p}{(}\PY{p}{[}\PY{n}{v}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{k}{for} \PY{n}{v} \PY{o+ow}{in} \PY{n}{metadata}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}
\PY{k}{except}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Mismatch between metadata and actual columns in the dataset}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Fields of the data: \textcolor{ansi-blue-intense}{['REG', 'PROV', 'NOME\_REGIONE', 'NOME\_PROVINCIA',
'NOME\_COMUNE', 'COD\_PROVCOM', 'CL\_ETA', 'GE', 'MASCHI\_15', 'MASCHI\_16',
'MASCHI\_17', 'MASCHI\_18', 'MASCHI\_19', 'MASCHI\_20', 'FEMMINE\_15', 'FEMMINE\_16',
'FEMMINE\_17', 'FEMMINE\_18', 'FEMMINE\_19', 'FEMMINE\_20', 'TOTALE\_15',
'TOTALE\_16', 'TOTALE\_17', 'TOTALE\_18', 'TOTALE\_19', 'TOTALE\_20']}
    \end{Verbatim}

    \hypertarget{data-preparation}{%
\subsection{Data preparation}\label{data-preparation}}

    Let's get rid of those records with no data, \emph{i.e.} with
\texttt{NAN} values (\emph{e.g.} `9999' for this dataset) in the
\texttt{T\_20} column of total number of deaths in 2020 (\emph{i.e.},
data not yet collected):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{16}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{T\PYZus{}20} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZus{}20}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field of total deaths in 2020: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{T\PYZus{}20}\PY{p}{)}
\PY{n}{NAN} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{nan}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} value of NAN mask: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{NAN}\PY{p}{)}
\PY{n}{data}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{n}{data}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{data}\PY{p}{[}\PY{n}{T\PYZus{}20}\PY{p}{]}\PY{o}{==}\PY{n}{NAN}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of cleaned records: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m \PYZhy{} Number of fields (unchanged...): }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} 
      \PY{o}{\PYZpc{}} \PY{n}{data}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
- field of total deaths in 2020: \textcolor{ansi-blue-intense}{TOTALE\_20}
- value of NAN mask: \textcolor{ansi-blue-intense}{9999}
Number of cleaned records: \textbf{198076} - Number of fields (unchanged{\ldots}):
\textbf{26}
    \end{Verbatim}

    Once the data cleaned, let's have a further look at some basic
information, for instance concerning spatial coverage (information
regarding province and cities/municipalities for which data have been
collected in 2020):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{17}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{CITY} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{city}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field of city names: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{CITY}\PY{p}{)}
\PY{n}{CITY\PYZus{}CODE} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{city\PYZus{}code}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field of city codes: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{CITY\PYZus{}CODE}\PY{p}{)}

\PY{n}{comuni} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{n}{CITY}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Cities/municipalities in the study: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{comuni}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of cities/municipalities: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{len}\PY{p}{(}\PY{n}{comuni}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
- field of city names: \textcolor{ansi-blue-intense}{NOME\_COMUNE}
- field of city codes: \textcolor{ansi-blue-intense}{COD\_PROVCOM}

Cities/municipalities in the study: \textcolor{ansi-blue-intense}{['Agliè' 'Almese' 'Avigliana' {\ldots}
'Villaputzu' 'Villasimius' 'Villasor']}
Number of cities/municipalities: \textbf{1450}
    \end{Verbatim}

    or the actual temporal coverage (prior to the year of study):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{18}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{years} \PY{o}{=} \PY{p}{[}\PY{n+nb}{int}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{20}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{tot}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} \PY{k}{for} \PY{n}{tot} \PY{o+ow}{in} \PY{n}{data}\PY{o}{.}\PY{n}{columns} \PY{k}{if} \PY{n}{tot}\PY{o}{.}\PY{n}{startswith}\PY{p}{(}\PY{n}{T\PYZus{}20}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{]}
\PY{n}{ystart}\PY{p}{,} \PY{n}{yend} \PY{o}{=}  \PY{n+nb}{min}\PY{p}{(}\PY{n}{years}\PY{p}{)}\PY{p}{,} \PY{n+nb}{max}\PY{p}{(}\PY{n}{years}\PY{p}{)}
\PY{n}{nyears} \PY{o}{=} \PY{n+nb}{len}\PY{p}{(}\PY{n}{years}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Temporal coverage \PYZhy{} Data collections considered: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[1m[}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{, }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{]}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[0m}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{ystart}\PY{p}{,} \PY{n}{yend}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Temporal coverage - Data collections considered: \textbf{[2015, 2020]}
    \end{Verbatim}

    Let's have a further look at the time series and the dates covered by
the collections in the various years:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{19}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{DAY} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field of day: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{DAY}\PY{p}{)}
\PY{n}{data}\PY{p}{[}\PY{n}{DAY}\PY{p}{]}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
- field of day: \textcolor{ansi-blue-intense}{GE}
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{19}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
0    0102
1    0104
2    0105
3    0106
4    0106
Name: GE, dtype: object
\end{Verbatim}
\end{tcolorbox}
        
    Actually, this is special coding of the days in the form ``MonthDay''
(``\emph{MeseMeseGiornoGiorno}''), as described in the metadata. We
introduce some basic functions to make date format conversions easier in
the following:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{20}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{DATEFMT} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{datefmt}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} date format: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{DATEFMT}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{The }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{day}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ field }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{ is described as follow: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} 
      \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{DAY}\PY{p}{,}\PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{desc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}

\PY{k}{def} \PY{n+nf}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{ge}\PY{p}{)}\PY{p}{:}
    \PY{k}{try}\PY{p}{:}
        \PY{n}{ge} \PY{o}{=} \PY{n}{datetime}\PY{o}{.}\PY{n}{strptime}\PY{p}{(}\PY{n}{ge}\PY{p}{,} \PY{n}{DATEFMT}\PY{p}{)}
    \PY{k}{except} \PY{n+ne}{ValueError}\PY{p}{:}  \PY{c+c1}{\PYZsh{} deal with 29/02   }
        \PY{n}{ge} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{strptime}\PY{p}{(}\PY{n}{ge}\PY{p}{,} \PY{n}{DATEFMT}\PY{p}{)}
    \PY{k}{except} \PY{n+ne}{TypeError}\PY{p}{:}   \PY{k}{pass}
    \PY{k}{try}\PY{p}{:}
        \PY{k}{return} \PY{n}{ge}\PY{o}{.}\PY{n}{day}\PY{p}{,} \PY{n}{ge}\PY{o}{.}\PY{n}{month}
    \PY{k}{except}\PY{p}{:}
        \PY{k}{return} \PY{n}{ge}\PY{o}{.}\PY{n}{tm\PYZus{}mday}\PY{p}{,} \PY{n}{ge}\PY{o}{.}\PY{n}{tm\PYZus{}mon}
\PY{k}{def} \PY{n+nf}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{ge}\PY{p}{,} \PY{n}{year}\PY{p}{)}\PY{p}{:}
    \PY{n}{d} \PY{o}{=} \PY{n+nb}{dict}\PY{p}{(}\PY{n+nb}{zip}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{d}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{ge}\PY{p}{)}\PY{p}{,} \PY{n}{year}\PY{p}{]}\PY{p}{)}\PY{p}{)}
    \PY{k}{return} \PY{n}{Datetime}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{n}{d}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{datetime}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
- date format: \textcolor{ansi-blue-intense}{\%m\%d}
The 'day' field GE is described as follow: \textcolor{ansi-blue-intense}{'Giorno di decesso (formato
variabile: MeseMeseGiornoGiorno).'}
    \end{Verbatim}

    Let's try to understand the purpose of these very basic methods:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{21}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{today} \PY{o}{=} \PY{n}{datetime}\PY{o}{.}\PY{n}{today}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Today}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{s date is represented in }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{datetime}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ format as: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{today}\PY{p}{)}
\PY{n}{today\PYZus{}ge} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}02d}\PY{l+s+si}{\PYZpc{}02d}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{today}\PY{o}{.}\PY{n}{month}\PY{p}{,} \PY{n}{today}\PY{o}{.}\PY{n}{day}\PY{p}{)} \PY{c+c1}{\PYZsh{} or also: datetime.strftime(today, DATEFMT) }
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{If today}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{s date was present in the IT dataset, it would be represented in the }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m field as: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} 
      \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{DAY}\PY{p}{,}\PY{n}{today\PYZus{}ge}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{What }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{get\PYZus{}daymonth}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ does, is simply return the }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{(day,month)}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ formatted date, whatever the input format:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} given today=}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{, get\PYZus{}daymonth(today) returns }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{today}\PY{p}{,}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{today}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} given today=}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, get\PYZus{}daymonth(today) returns }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{today\PYZus{}ge}\PY{p}{,}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{today}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{Then }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{get\PYZus{}datetime}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ retrieves the matching }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{(day,month)}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ of a given date in any other year:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} given today=}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{, get\PYZus{}datetime(today,2019) returns }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{today}\PY{p}{,}\PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{today}\PY{p}{,}\PY{l+m+mi}{2005}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} given today=}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{, get\PYZus{}datetime(today, 1912) returns also }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{today\PYZus{}ge}\PY{p}{,}\PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{today}\PY{p}{,}\PY{l+m+mi}{1912}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Note in particular for the leap day:}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} get\PYZus{}datetime(}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{0229}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{,2000) returns }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{0229}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+m+mi}{2000}\PY{p}{)}\PY{p}{)}
\PY{k}{try}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} get\PYZus{}datetime(}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{0229}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{,2019) returns }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{0229}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+m+mi}{2019}\PY{p}{)}\PY{p}{)}
\PY{k}{except} \PY{n+ne}{ValueError}\PY{p}{:}
    \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} get\PYZus{}datetime(}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{0229}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{,2019) fails as we could expect...}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Today's date is represented in 'datetime' format as: 2020-05-07 01:03:58.416502
If today's date was present in the IT dataset, it would be represented in the
\textbf{GE} field as: \textbf{'0507'}

What 'get\_daymonth' does, is simply return the '(day,month)' formatted date,
whatever the input format:
- given today=2020-05-07 01:03:58.416502, get\_daymonth(today) returns (7, 5)
- given today='0507', get\_daymonth(today) returns (7, 5)

Then 'get\_datetime' retrieves the matching '(day,month)' of a given date in any
other year:
- given today=2020-05-07 01:03:58.416502, get\_datetime(today,2019) returns
2005-05-07 00:00:00
- given today='0507', get\_datetime(today, 1912) returns also 1912-05-07 00:00:00
Note in particular for the leap day:
- get\_datetime('0229',2000) returns 2000-02-29 00:00:00
- get\_datetime('0229',2019) fails as we could expect{\ldots}
    \end{Verbatim}

    Given the \texttt{DAY} (\emph{i.e.}, ``GE'') column, we can find out
about the first and last days represented in the study:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{22}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dstart}\PY{p}{,} \PY{n}{dend} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{n}{DAY}\PY{p}{]}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{data}\PY{p}{[}\PY{n}{DAY}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Period of data collection considered: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[1m[}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{, }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{]}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[0m}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PYZbs{}
      \PY{p}{(}\PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{dstart}\PY{p}{)}\PY{p}{,} \PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{dend}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Period of data collection considered: \textbf{[1/1, 28/3]}
    \end{Verbatim}

    Considering the temporal corevage (over \textgreater{}4 years), we
introduce a year of reference to define the (maximal) length of the time
series:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{23}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{YREF} \PY{o}{=} \PY{l+m+mi}{2000} 
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{A leap year for sure: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{!}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{YREF}\PY{p}{)}
\PY{n}{dstartref}\PY{p}{,} \PY{n}{dendref} \PY{o}{=} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{dstart}\PY{p}{,} \PY{n}{YREF}\PY{p}{)}\PY{p}{,} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{dend}\PY{p}{,} \PY{n}{YREF}\PY{p}{)}

\PY{n}{span} \PY{o}{=} \PY{n}{Datetime}\PY{o}{.}\PY{n}{span}\PY{p}{(}\PY{n}{since}\PY{o}{=}\PY{n}{dstartref}\PY{p}{,} \PY{n}{until}\PY{o}{=}\PY{n}{dendref}\PY{p}{)}
\PY{n}{ndays} \PY{o}{=} \PY{n}{span}\PY{o}{.}\PY{n}{days} \PY{o}{+} \PY{l+m+mi}{1} \PY{c+c1}{\PYZsh{} +1 because dates are inclusive}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Max lenght of the time series, i.e. number of days covered by the data collection: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ days}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[0m}\PY{l+s+s1}{\PYZsq{}} 
      \PY{o}{\PYZpc{}} \PY{n}{ndays}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
A leap year for sure: 2000!
Max lenght of the time series, i.e. number of days covered by the data
collection: \textbf{88 days}
    \end{Verbatim}

    One more consideration regarding the presence of a leapday in the
time-series:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{24}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{leapday} \PY{o}{=} \PY{n}{Datetime}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{YREF}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{d}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{29}\PY{p}{\PYZcb{}}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{datetime}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{spanleap} \PY{o}{=} \PY{n}{Datetime}\PY{o}{.}\PY{n}{span}\PY{p}{(}\PY{n}{since}\PY{o}{=}\PY{n}{dstartref}\PY{p}{,} \PY{n}{until}\PY{o}{=}\PY{n}{leapday}\PY{p}{)}
\PY{n}{ileapday} \PY{o}{=} \PY{n}{spanleap}\PY{o}{.}\PY{n}{days} \PY{c+c1}{\PYZsh{} note that indexing starts at 0}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time series will be padded in position: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[0m corresponding to leapday 29/02}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{ileapday}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Time series will be padded in position: \textbf{59} corresponding to leapday
29/02
    \end{Verbatim}

    We also introduce, for the rest of the study, an timeline index based on
the longest possible time series (for instance during the \texttt{YREF}
leap year):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{25}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{idx\PYZus{}timeline} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{date\PYZus{}range}\PY{p}{(}\PY{n}{start}\PY{o}{=}\PY{n}{dstartref}\PY{p}{,} \PY{n}{end}\PY{o}{=}\PY{n}{dendref}\PY{p}{,} \PY{n}{freq}\PY{o}{=}\PY{n}{timedelta}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
\PY{k}{assert} \PY{n+nb}{len}\PY{p}{(}\PY{n}{idx\PYZus{}timeline}\PY{p}{)} \PY{o}{==} \PY{n}{ndays}
\PY{n+nb}{print}\PY{p}{(}\PY{n}{idx\PYZus{}timeline}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
DatetimeIndex(['2000-01-01', '2000-01-02', '2000-01-03', '2000-01-04',
               '2000-01-05', '2000-01-06', '2000-01-07', '2000-01-08',
               '2000-01-09', '2000-01-10', '2000-01-11', '2000-01-12',
               '2000-01-13', '2000-01-14', '2000-01-15', '2000-01-16',
               '2000-01-17', '2000-01-18', '2000-01-19', '2000-01-20',
               '2000-01-21', '2000-01-22', '2000-01-23', '2000-01-24',
               '2000-01-25', '2000-01-26', '2000-01-27', '2000-01-28',
               '2000-01-29', '2000-01-30', '2000-01-31', '2000-02-01',
               '2000-02-02', '2000-02-03', '2000-02-04', '2000-02-05',
               '2000-02-06', '2000-02-07', '2000-02-08', '2000-02-09',
               '2000-02-10', '2000-02-11', '2000-02-12', '2000-02-13',
               '2000-02-14', '2000-02-15', '2000-02-16', '2000-02-17',
               '2000-02-18', '2000-02-19', '2000-02-20', '2000-02-21',
               '2000-02-22', '2000-02-23', '2000-02-24', '2000-02-25',
               '2000-02-26', '2000-02-27', '2000-02-28', '2000-02-29',
               '2000-03-01', '2000-03-02', '2000-03-03', '2000-03-04',
               '2000-03-05', '2000-03-06', '2000-03-07', '2000-03-08',
               '2000-03-09', '2000-03-10', '2000-03-11', '2000-03-12',
               '2000-03-13', '2000-03-14', '2000-03-15', '2000-03-16',
               '2000-03-17', '2000-03-18', '2000-03-19', '2000-03-20',
               '2000-03-21', '2000-03-22', '2000-03-23', '2000-03-24',
               '2000-03-25', '2000-03-26', '2000-03-27', '2000-03-28'],
              dtype='datetime64[ns]', freq='D')
    \end{Verbatim}

    \hypertarget{figure-1---map-of-anpr-municipalities-included-in-the-data-set}{%
\subsection{Figure 1 - Map of ANPR municipalities included in the
data
set}\label{figure-1---map-of-anpr-municipalities-included-in-the-data-set}}

    Similarly to the mortality dataset, the geographical dataset that will
help us identify (and locate) cities/municipalities in the dataset is
represented by a metadata info file, namely the \texttt{JSON} file
`ITmetadata.json' that should be contained in this directory:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{26}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{GEOMETA} \PY{o}{=} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{join}\PY{p}{(}\PY{n}{THISDIR}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ITmetageo.json}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{k}{try}\PY{p}{:}
    \PY{k}{assert} \PY{n}{os}\PY{o}{.}\PY{n}{path}\PY{o}{.}\PY{n}{exists}\PY{p}{(}\PY{n}{GEOMETA}\PY{p}{)}
\PY{k}{except}\PY{p}{:}
    \PY{o}{!}wget \PYZhy{}O \PY{n+nv}{\PYZdl{}GEOMETA} https://raw.githubusercontent.com/gjacopo/morbstat/master/ITmetageo.json
\PY{n}{dgeoIT} \PY{o}{=} \PY{n}{MortDatIT}\PY{p}{(}\PY{n}{GEOMETA}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    Note the location and format (shapefile files in a remote zip file) of
the source datasets:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{27}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Source file: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{dgeoIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{source}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Datasets: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{dgeoIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{file}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Source file: http://www.istat.it/storage/cartografia/confini\_amministrativi/non\_
generalizzati/Limiti01012020.zip
Datasets: \textcolor{ansi-blue-intense}{'['Com01012020\_WGS84.shp', 'Com01012020\_WGS84.shx',
'Com01012020\_WGS84.dbf', 'Com01012020\_WGS84.prj']'}
    \end{Verbatim}

    We will load the geographical data using that same \texttt{load\_data}
method as earlier. Because of the way it is implemented (the package
\texttt{pyeudatnat} uses \texttt{geopandas} for the representation and
handling of geographical/vector datasets), the data will need to be
loaded on the disk (hence the option \texttt{on\_disk=True} below). In
addition, because the format of the data is known (shapefile), we ensure
only this file is loaded (the option \texttt{infer\_fmt=False} will
prevent from trying to load all the other files {[}`.shx', `.dbf',
`.prj'{]} that normaly accompany the shapefile `.shp'). You could also
add the keyword option
\texttt{fmt=\textquotesingle{}shapefile\textquotesingle{}} below:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{28}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dgeoIT}\PY{o}{.}\PY{n}{load\PYZus{}data}\PY{p}{(}\PY{n}{on\PYZus{}disk}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{infer\PYZus{}fmt}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n+nb}{print} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Geo information retrieved on }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[0m}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{Datetime}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{n}{Datetime}\PY{o}{.}\PY{n}{TODAY}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{Y}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Geo information retrieved on \textbf{07/05/2020}
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
/Users/gjacopo/Developments/pyEUDatNat/pyeudatnat/io.py:939: UserWarning:
! 'SHP' data loaded in dataframe !
  warnings.warn("\textbackslash{}n! '\%s' data loaded in dataframe !" \% f.upper())
/Users/gjacopo/Developments/pyEUDatNat/pyeudatnat/io.py:1086: UserWarning:
! File 'Limiti01012020/Com01012020/Com01012020\_WGS84.shx' will not be loaded !
  warnings.warn("\textbackslash{}n! File '\%s' will not be loaded !" \% file)
/Users/gjacopo/Developments/pyEUDatNat/pyeudatnat/io.py:1086: UserWarning:
! File 'Limiti01012020/Com01012020/Com01012020\_WGS84.dbf' will not be loaded !
  warnings.warn("\textbackslash{}n! File '\%s' will not be loaded !" \% file)
/Users/gjacopo/Developments/pyEUDatNat/pyeudatnat/io.py:1086: UserWarning:
! File 'Limiti01012020/Com01012020/Com01012020\_WGS84.prj' will not be loaded !
  warnings.warn("\textbackslash{}n! File '\%s' will not be loaded !" \% file)
    \end{Verbatim}

    We can check the projection used for representing the data. In that case
(`WGS84' or `EPSG:32632' code), data are simply represented by their
geographical (latitute/longitude) coordinates:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{29}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{n}{dgeoIT}\PY{o}{.}\PY{n}{data}\PY{o}{.}\PY{n}{crs}\PY{p}{)}
\PY{n}{dgeoIT}\PY{o}{.}\PY{n}{data}\PY{o}{.}\PY{n}{crs}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
epsg:32632
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{29}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<Projected CRS: EPSG:32632>
Name: WGS 84 / UTM zone 32N
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: World - N hemisphere - 6°E to 12°E - by country
- bounds: (6.0, 0.0, 12.0, 84.0)
Coordinate Operation:
- name: UTM zone 32N
- method: Transverse Mercator
Datum: World Geodetic System 1984
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{30}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Attributes of the geodata (including geometries): }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s1}{[0m}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{list}\PY{p}{(}\PY{n}{dgeoIT}\PY{o}{.}\PY{n}{data}\PY{o}{.}\PY{n}{columns}\PY{p}{)}\PY{p}{)}  
\PY{n}{dgeoIT}\PY{o}{.}\PY{n}{data}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Attributes of the geodata (including geometries): \textcolor{ansi-blue-intense}{['COD\_RIP', 'COD\_REG',
'COD\_PROV', 'COD\_CM', 'COD\_UTS', 'PRO\_COM', 'PRO\_COM\_T', 'COMUNE', 'COMUNE\_A',
'CC\_UTS', 'SHAPE\_LENG', 'SHAPE\_AREA', 'SHAPE\_LEN', 'geometry']}
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{30}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
   COD\_RIP  COD\_REG  COD\_PROV  COD\_CM  COD\_UTS  PRO\_COM PRO\_COM\_T  \textbackslash{}
0        1        1         1     201      201     1077    001077
1        1        1         1     201      201     1079    001079
2        1        1         1     201      201     1089    001089
3        1        1         1     201      201     1006    001006
4        1        1         1     201      201     1007    001007

        COMUNE COMUNE\_A  CC\_UTS    SHAPE\_LENG    SHAPE\_AREA     SHAPE\_LEN  \textbackslash{}
0   Chiaverano     None       0  18164.369945  1.202212e+07  18164.236621
1  Chiesanuova     None       0  10777.398475  4.118911e+06  10777.318814
2       Coazze     None       0  41591.434852  5.657268e+07  41591.122092
3       Almese     None       0  17058.567837  1.787564e+07  17058.439037
4      Alpette     None       0   9795.635259  5.626076e+06   9795.562269

                                            geometry
0  POLYGON ((414358.390 5042001.044, 414381.796 5{\ldots}
1  POLYGON ((394621.039 5031581.116, 394716.100 5{\ldots}
2  POLYGON ((364914.897 4993224.894, 364929.991 4{\ldots}
3  POLYGON ((376934.962 4999073.854, 376960.555 4{\ldots}
4  POLYGON ((388890.737 5030465.123, 388945.987 5{\ldots}
\end{Verbatim}
\end{tcolorbox}
        
    In particular, the geographical (vector) information is specifically
provided through the \texttt{geometry} field of the dataset as a set of
\texttt{shapely} structures:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{31}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dgeoIT}\PY{o}{.}\PY{n}{data}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{geometry}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{31}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
0    POLYGON ((414358.390 5042001.044, 414381.796 5{\ldots}
1    POLYGON ((394621.039 5031581.116, 394716.100 5{\ldots}
2    POLYGON ((364914.897 4993224.894, 364929.991 4{\ldots}
3    POLYGON ((376934.962 4999073.854, 376960.555 4{\ldots}
4    POLYGON ((388890.737 5030465.123, 388945.987 5{\ldots}
Name: geometry, dtype: geometry
\end{Verbatim}
\end{tcolorbox}
        
    We will `join' the information from both datasets by matching the
field/attribute that represent the city code in the two datasets:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{32}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{CITY\PYZus{}CODE} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{city\PYZus{}code}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field uniquely identifying cities/municipalities in mortality dataset: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{CITY\PYZus{}CODE}\PY{p}{)}
\PY{n}{PRO\PYZus{}COM\PYZus{}T} \PY{o}{=} \PY{n}{dgeoIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{PRO\PYZus{}COM\PYZus{}T}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field uniquely identifying cities/municipalities in geographical reference dataset: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{PRO\PYZus{}COM\PYZus{}T}\PY{p}{)}
\PY{n}{code\PYZus{}comuni} \PY{o}{=} \PY{n}{Structure}\PY{o}{.}\PY{n}{uniq\PYZus{}list}\PY{p}{(}\PY{n}{data}\PY{p}{[}\PY{n}{CITY\PYZus{}CODE}\PY{p}{]}\PY{o}{.}\PY{n}{to\PYZus{}list}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{k}{assert} \PY{n+nb}{len}\PY{p}{(}\PY{n}{code\PYZus{}comuni}\PY{p}{)} \PY{o}{==} \PY{n+nb}{len}\PY{p}{(}\PY{n}{comuni}\PY{p}{)} 
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
- field uniquely identifying cities/municipalities in mortality dataset:
\textcolor{ansi-blue-intense}{COD\_PROVCOM}
- field uniquely identifying cities/municipalities in geographical reference
dataset: \textcolor{ansi-blue-intense}{PRO\_COM\_T}
    \end{Verbatim}

    Note that the `join' operation is not an actual `join', instead we
filter out the geographical datasets to keep only those
cities/municipalities that are also present in the mortality dataset:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{33}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{geodata} \PY{o}{=} \PY{n}{dgeoIT}\PY{o}{.}\PY{n}{data}\PY{p}{[}\PY{n}{dgeoIT}\PY{o}{.}\PY{n}{data}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{PRO\PYZus{}COM\PYZus{}T}\PY{p}{)}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{code\PYZus{}comuni}\PY{p}{)}\PY{p}{]}
\PY{n}{geodata}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{33}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
    COD\_RIP  COD\_REG  COD\_PROV  COD\_CM  COD\_UTS  PRO\_COM PRO\_COM\_T  \textbackslash{}
3         1        1         1     201      201     1006    001006
11        1        1         1     201      201     1020    001020
15        1        1         1     201      201     1066    001066
19        1        1         1     201      201     1024    001024
31        1        1         1     201      201     1139    001139

                  COMUNE COMUNE\_A  CC\_UTS    SHAPE\_LENG    SHAPE\_AREA  \textbackslash{}
3                 Almese     None       0  17058.567837  1.787564e+07
11             Banchette     None       0  13861.283510  2.028854e+06
15         Castellamonte     None       0  56627.619939  3.870630e+07
19              Beinasco     None       0  18927.804428  6.734254e+06
31  Luserna San Giovanni     None       0  31182.813988  1.774138e+07

       SHAPE\_LEN                                           geometry
3   17058.439037  POLYGON ((376934.962 4999073.854, 376960.555 4{\ldots}
11  13861.181642  MULTIPOLYGON (((410556.045 5035845.088, 410737{\ldots}
15  56627.197389  MULTIPOLYGON (((399851.593 5035334.590, 399858{\ldots}
19  18927.661943  POLYGON ((389377.696 4987362.417, 389538.013 4{\ldots}
31  31182.577534  POLYGON ((362241.646 4966621.595, 362247.927 4{\ldots}
\end{Verbatim}
\end{tcolorbox}
        
    We simply map the remaining geometries (that exclusively correspond to
cities present in the mortality dataset) to get a visual hint on the
representativeness of the samples in the dataset (samples mostly
concentrated around the Lombardia region):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{34}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{f}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{mplt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}\PY{p}{)}
\PY{n}{geodata}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}axis\PYZus{}off}\PY{p}{(}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 1: Map of ANPR municipalities included in the data set}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{mplt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_70_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figure-2---daily-and-cumulated-deaths-for-all-municipalities-in-the-data-set}{%
\subsection{Figure 2 - Daily and cumulated deaths for all
municipalities in the data
set}\label{figure-2---daily-and-cumulated-deaths-for-all-municipalities-in-the-data-set}}

    We now represent the daily and cumulated deaths for the entire
population and for all municipalities present in the dataset.

Simply group by date and sum the total counts of deaths per year
(``TOTAL\_**'') over all other remaining fields (\emph{e.g.}, age class
and cities):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{35}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dailydeaths} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{:}
    \PY{n}{TCOL} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
    \PY{n}{dailydeaths}\PY{p}{[}\PY{n}{y}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{DAY}\PY{p}{)}\PY{p}{[}\PY{n}{TCOL}\PY{p}{]}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{dailydeaths}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{35}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
      2015  2016  2017  2018  2019  2020
GE
0101   585   507   656   657   534   513
0102   617   529   761   668   587   571
0103   608   546   720   595   563   589
0104   621   561   733   628   527   538
0105   644   520   766   671   534   545
\end{Verbatim}
\end{tcolorbox}
        
    We also possibly pad the data for non-leap years on the date 29/02:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{36}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Counts on 29/02 }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1mbefore}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m padding:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}\PY{n}{ileapday}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{p}{)}
\PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{:}
    \PY{k}{if} \PY{n}{calendar}\PY{o}{.}\PY{n}{isleap}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{:} \PY{k}{continue}
    \PY{n}{yloc} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{columns}\PY{o}{.}\PY{n}{get\PYZus{}loc}\PY{p}{(}\PY{n}{y}\PY{p}{)}
    \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{p}{,}\PY{n}{yloc}\PY{p}{]} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{yloc}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Counts on 29/02 }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1mafter}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m padding:}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s2}{ }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}\PY{n}{ileapday}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{,}\PY{p}{:}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Counts on 29/02 \textbf{before} padding:
       2015  2016  2017  2018  2019  2020
GE
0228   527   510   581   560   590   568
0229     0   489     0     0     0   551
Counts on 29/02 \textbf{after} padding:
       2015  2016  2017  2018  2019  2020
GE
0228   527   510   581   560   590   568
0229   527   489   581   560   590   551
    \end{Verbatim}

    Note that at this stage, the table is indexed by the \texttt{DAY}
(\emph{i.e.}, `GE') field (in the form \emph{`MeseMeseGiornoGiorno'}).
Instead we want to set the index to the known dates and reindex with the
actual timeline since days may be missing (?):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{37}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Initial index: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{index}\PY{p}{)}       
\PY{n}{dailydeaths}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{dailydeaths}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{to\PYZus{}series}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{ge}\PY{p}{:} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{ge}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{dailydeaths} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{reindex}\PY{p}{(}\PY{n}{idx\PYZus{}timeline}\PY{p}{,} \PY{n}{fill\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}       
\PY{c+c1}{\PYZsh{} instead of dailydeaths.set\PYZus{}index(idx\PYZus{}rng, inplace=True)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Index reset to actual timeline an garanteed complete days: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{index}\PY{p}{)}       
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Initial index: Index(['0101', '0102', '0103', '0104', '0105', '0106', '0107',
'0108', '0109',
       '0110', '0111', '0112', '0113', '0114', '0115', '0116', '0117', '0118',
       '0119', '0120', '0121', '0122', '0123', '0124', '0125', '0126', '0127',
       '0128', '0129', '0130', '0131', '0201', '0202', '0203', '0204', '0205',
       '0206', '0207', '0208', '0209', '0210', '0211', '0212', '0213', '0214',
       '0215', '0216', '0217', '0218', '0219', '0220', '0221', '0222', '0223',
       '0224', '0225', '0226', '0227', '0228', '0229', '0301', '0302', '0303',
       '0304', '0305', '0306', '0307', '0308', '0309', '0310', '0311', '0312',
       '0313', '0314', '0315', '0316', '0317', '0318', '0319', '0320', '0321',
       '0322', '0323', '0324', '0325', '0326', '0327', '0328'],
      dtype='object', name='GE')
Index reset to actual timeline an garanteed complete days:
DatetimeIndex(['2000-01-01', '2000-01-02', '2000-01-03', '2000-01-04',
               '2000-01-05', '2000-01-06', '2000-01-07', '2000-01-08',
               '2000-01-09', '2000-01-10', '2000-01-11', '2000-01-12',
               '2000-01-13', '2000-01-14', '2000-01-15', '2000-01-16',
               '2000-01-17', '2000-01-18', '2000-01-19', '2000-01-20',
               '2000-01-21', '2000-01-22', '2000-01-23', '2000-01-24',
               '2000-01-25', '2000-01-26', '2000-01-27', '2000-01-28',
               '2000-01-29', '2000-01-30', '2000-01-31', '2000-02-01',
               '2000-02-02', '2000-02-03', '2000-02-04', '2000-02-05',
               '2000-02-06', '2000-02-07', '2000-02-08', '2000-02-09',
               '2000-02-10', '2000-02-11', '2000-02-12', '2000-02-13',
               '2000-02-14', '2000-02-15', '2000-02-16', '2000-02-17',
               '2000-02-18', '2000-02-19', '2000-02-20', '2000-02-21',
               '2000-02-22', '2000-02-23', '2000-02-24', '2000-02-25',
               '2000-02-26', '2000-02-27', '2000-02-28', '2000-02-29',
               '2000-03-01', '2000-03-02', '2000-03-03', '2000-03-04',
               '2000-03-05', '2000-03-06', '2000-03-07', '2000-03-08',
               '2000-03-09', '2000-03-10', '2000-03-11', '2000-03-12',
               '2000-03-13', '2000-03-14', '2000-03-15', '2000-03-16',
               '2000-03-17', '2000-03-18', '2000-03-19', '2000-03-20',
               '2000-03-21', '2000-03-22', '2000-03-23', '2000-03-24',
               '2000-03-25', '2000-03-26', '2000-03-27', '2000-03-28'],
              dtype='datetime64[ns]', freq='D')
    \end{Verbatim}

    We introduce two additional time-series for comparison, the count of
deaths averaged over all the years prior to the year of study
(\texttt{years\_exc}):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{38}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{years\PYZus{}exc} \PY{o}{=} \PY{n}{years}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
\PY{n}{years\PYZus{}exc}\PY{o}{.}\PY{n}{remove}\PY{p}{(}\PY{n}{YEAR}\PY{p}{)}

\PY{n}{avdailydeathsexc} \PY{o}{=} \PY{n}{dailydeaths}\PY{p}{[}\PY{n}{years\PYZus{}exc}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{skipna} \PY{o}{=}\PY{k+kc}{True}\PY{p}{)} 
\PY{n}{avdailydeathsexc}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{38}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
2000-01-01    587.8
2000-01-02    632.4
2000-01-03    606.4
2000-01-04    614.0
2000-01-05    627.0
              {\ldots}
2000-03-24    490.0
2000-03-25    493.4
2000-03-26    487.8
2000-03-27    486.6
2000-03-28    505.4
Freq: D, Length: 88, dtype: float64
\end{Verbatim}
\end{tcolorbox}
        
    and the average count of deaths by week:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{39}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{weeklydeaths} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{resample}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{W}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
\PY{n}{weeklydeaths}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{39}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                  2015        2016        2017        2018        2019  \textbackslash{}
2000-01-02  601.000000  518.000000  708.500000  662.500000  560.500000
2000-01-09  630.714286  539.857143  721.142857  656.285714  559.714286
2000-01-16  601.714286  532.714286  754.714286  644.285714  598.142857
2000-01-23  611.428571  531.857143  701.571429  613.571429  582.428571
2000-01-30  607.428571  542.000000  654.285714  589.000000  595.142857

                  2020
2000-01-02  542.000000
2000-01-09  558.428571
2000-01-16  556.571429
2000-01-23  547.285714
2000-01-30  550.857143
\end{Verbatim}
\end{tcolorbox}
        
    For displaying the data (likewise the figures in the original
publication), we introduce our own `house-made' plotting function to
further simplifying the automated display of time-series:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{40}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{plot\PYZus{}one}\PY{p}{(}\PY{n}{dat}\PY{p}{,} \PY{n}{index} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{bar}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} 
             \PY{n}{fig}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{n}{\PYZus{}FIGSIZE\PYZus{}}\PY{p}{,} \PY{n}{dpi}\PY{o}{=}\PY{n}{\PYZus{}DPI\PYZus{}}\PY{p}{,} \PY{n}{shp} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} 
             \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{v}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}  
             \PY{n}{grid} \PY{o}{=} \PY{k+kc}{False}\PY{p}{,} \PY{n}{xticks} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{xticklabels} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{k+kc}{False}\PY{p}{,} 
             \PY{n}{locator} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} 
             \PY{n}{xlabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{suptitle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{:} 
    \PY{k}{if} \PY{n}{ax} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
        \PY{k}{if} \PY{n}{shp} \PY{o+ow}{in} \PY{p}{(}\PY{k+kc}{None}\PY{p}{,}\PY{p}{[}\PY{p}{]}\PY{p}{,}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{:} \PY{n}{shp} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{k}{if} \PY{n}{dpi} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}     
            \PY{n}{fig}\PY{p}{,} \PY{n}{pax} \PY{o}{=} \PY{n}{mplt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{o}{*}\PY{n}{shp}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{n}{figsize}\PY{p}{,} \PY{n}{constrained\PYZus{}layout}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}               
            \PY{n}{fig}\PY{p}{,} \PY{n}{pax} \PY{o}{=} \PY{n}{mplt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{o}{*}\PY{n}{shp}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{n}{figsize}\PY{p}{,} \PY{n}{dpi}\PY{o}{=}\PY{n}{dpi}\PY{p}{,} \PY{n}{constrained\PYZus{}layout}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{k}{if} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{pax}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{ndarray}\PY{p}{)}\PY{p}{:}
            \PY{k}{if} \PY{n}{pax}\PY{o}{.}\PY{n}{ndim} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}    \PY{n}{ax\PYZus{}} \PY{o}{=} \PY{n}{pax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
            \PY{k}{else}\PY{p}{:}               \PY{n}{ax\PYZus{}} \PY{o}{=} \PY{n}{pax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}
        \PY{k}{else}\PY{p}{:}
            \PY{n}{ax\PYZus{}} \PY{o}{=} \PY{n}{pax}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{ax\PYZus{}}\PY{p}{,} \PY{n}{pax} \PY{o}{=} \PY{n}{ax}\PY{p}{,} \PY{k+kc}{None}
    \PY{k}{if} \PY{n}{index} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
        \PY{n}{index} \PY{o}{=} \PY{n}{dat}\PY{o}{.}\PY{n}{index}
    \PY{k}{if} \PY{n}{bar} \PY{o+ow}{is} \PY{k+kc}{True}\PY{p}{:}
        \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{bar}\PY{p}{(}\PY{n}{dat}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{values}\PY{p}{,} 
                \PY{n}{dat}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{]} \PY{k}{if} \PY{n}{one} \PY{o+ow}{is} \PY{k+kc}{None} \PY{k}{else} \PY{n}{dat}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{n}{one}\PY{p}{]}\PY{p}{,} 
                \PY{n}{color}\PY{o}{=}\PY{n}{color}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{n}{label}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{dat}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{]} \PY{k}{if} \PY{n}{one} \PY{o+ow}{is} \PY{k+kc}{None} \PY{k}{else} \PY{n}{dat}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,} \PY{n}{one}\PY{p}{]}\PY{p}{,} 
                 \PY{n}{c}\PY{o}{=}\PY{n}{color}\PY{p}{,} \PY{n}{marker}\PY{o}{=}\PY{n}{marker}\PY{p}{,} \PY{n}{markersize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{n}{linestyle}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mf}{0.6}\PY{p}{,}
                 \PY{n}{label}\PY{o}{=}\PY{n}{label}\PY{p}{)}
    \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{n}{xlabel}\PY{p}{)}\PY{p}{,} \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{n}{ylabel}\PY{p}{)}
    \PY{k}{if} \PY{n}{grid} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{False}\PY{p}{:}       \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{linewidth}\PY{o}{=}\PY{n}{grid}\PY{p}{)}
    \PY{k}{if} \PY{n}{xticks} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}      \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{set\PYZus{}xticks}\PY{p}{(}\PY{n}{xticks}\PY{p}{)}
    \PY{k}{if} \PY{n}{xticklabels} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:} \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{set\PYZus{}xticklabels}\PY{p}{(}\PY{n}{xticklabels}\PY{p}{)}            
    \PY{k}{if} \PY{n}{xrottick} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{False}\PY{p}{:}   \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{tick\PYZus{}params}\PY{p}{(}\PY{n}{axis} \PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{labelrotation}\PY{o}{=}\PY{n}{xrottick}\PY{p}{)}
    \PY{k}{if} \PY{n}{formatter} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}   \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}major\PYZus{}formatter}\PY{p}{(}\PY{n}{formatter}\PY{p}{)}
    \PY{k}{if} \PY{n}{locator} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}     \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}major\PYZus{}locator}\PY{p}{(}\PY{n}{locator}\PY{p}{)}
    \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{fontsize}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{small}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{n}{title} \PY{o+ow}{not} \PY{o+ow}{in} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}  \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{title}\PY{p}{,}  \PY{n}{fontsize}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{medium}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{n}{fig} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None} \PY{o+ow}{and} \PY{n}{suptitle} \PY{o+ow}{not} \PY{o+ow}{in} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}       
        \PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{n}{suptitle}\PY{p}{,}  \PY{n}{fontsize}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{medium}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{n}{pax} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
        \PY{k}{return} \PY{n}{fig}\PY{p}{,} \PY{n}{pax}
\end{Verbatim}
\end{tcolorbox}

    Let's see quickly how this works in practice on a dummy example:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{41}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{ts} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randn}\PY{p}{(}\PY{n}{ndays}\PY{p}{)}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{n}{idx\PYZus{}timeline}\PY{p}{)}
\PY{n}{plot\PYZus{}one}\PY{p}{(}\PY{n}{ts}\PY{p}{,}\PY{n}{index}\PY{o}{=}\PY{n+nb}{slice}\PY{p}{(}\PY{n}{dstartref}\PY{p}{,}\PY{n}{dendref}\PY{p}{)}\PY{p}{,} \PY{n}{bar}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{random}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{,}
         \PY{n}{suptitle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}DUMMY\PYZhy{} a great graph \PYZhy{}DUMMY\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}
        \PY{p}{)}

\PY{n}{tsc} \PY{o}{=} \PY{n}{ts}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}
\PY{n}{locator} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DayLocator}\PY{p}{(}\PY{n}{bymonthday}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)} 
\PY{n}{formatter} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DateFormatter}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plot\PYZus{}one}\PY{p}{(}\PY{n}{ts}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{n+nb}{slice}\PY{p}{(}\PY{n}{dstartref}\PY{p}{,}\PY{n}{dendref}\PY{p}{)}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{random}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{shp}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} 
                   \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{,}
                   \PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
                  \PY{p}{)}
\PY{n}{plot\PYZus{}one}\PY{p}{(}\PY{n}{tsc}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{n+nb}{slice}\PY{p}{(}\PY{n}{dstartref}\PY{p}{,}\PY{n}{dendref}\PY{p}{)}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cumsum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fig}\PY{o}{=}\PY{n}{fig}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} 
         \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.2}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dashdot}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{marker} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
         \PY{n}{suptitle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}DUMMY\PYZhy{}  a greater graph \PYZhy{}DUMMY\PYZhy{} }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
         \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
        \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_85_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_85_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Now, we can use it to plot the 3 created series all together to get a
first `flavour' of the temporal evolution:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{42}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{locator} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DayLocator}\PY{p}{(}\PY{n}{bymonthday}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{15}\PY{p}{]}\PY{p}{)} 
\PY{n}{formatter} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DateFormatter}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plot\PYZus{}one}\PY{p}{(}\PY{n}{dailydeaths}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{n+nb}{slice}\PY{p}{(}\PY{n}{dstartref}\PY{p}{,}\PY{n}{dendref}\PY{p}{)}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{daily }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{YEAR}\PY{p}{,}  
                   \PY{n}{suptitle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Death timeseries for all municipalities in the data set}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{,}
                   \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
                  \PY{p}{)}

\PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{weeklydeaths}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{dstartref}\PY{p}{:}\PY{n}{dendref}\PY{p}{,} \PY{n}{YEAR}\PY{p}{]}\PY{p}{,}
        \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{markersize}\PY{o}{=}\PY{l+m+mi}{6}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{weekly mean }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{YEAR}
       \PY{p}{)}

\PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{avdailydeathsexc}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{dstartref}\PY{p}{:}\PY{n}{dendref}\PY{p}{]}\PY{p}{,}
        \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
        \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{daily averaged over [}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{,}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{]}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n+nb}{min}\PY{p}{(}\PY{n}{years\PYZus{}exc}\PY{p}{)}\PY{p}{,}\PY{n+nb}{max}\PY{p}{(}\PY{n}{years\PYZus{}exc}\PY{p}{)}\PY{p}{)}
       \PY{p}{)}

\PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{42}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x11764e4d0>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_87_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We introduce another ``house-made'' plotting method:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{43}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{dat}\PY{p}{,} \PY{n}{index} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,}  
                   \PY{n}{fig}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{shp} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n}{dpi}\PY{o}{=}\PY{n}{\PYZus{}DPI\PYZus{}}\PY{p}{,}
                   \PY{n}{xlabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{k+kc}{False}\PY{p}{,} \PY{n}{legend} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,}                 
                   \PY{n}{grid} \PY{o}{=} \PY{k+kc}{False}\PY{p}{,} \PY{n}{suptitle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{locator} \PY{o}{=} \PY{k+kc}{None}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{k+kc}{None}\PY{p}{)}\PY{p}{:}    
    \PY{k}{if} \PY{n}{ax} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
        \PY{k}{if} \PY{n}{shp} \PY{o+ow}{in} \PY{p}{(}\PY{k+kc}{None}\PY{p}{,}\PY{p}{[}\PY{p}{]}\PY{p}{,}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{:} \PY{n}{shp} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{k}{if} \PY{n}{dpi} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}     \PY{n}{fig}\PY{p}{,} \PY{n}{pax} \PY{o}{=} \PY{n}{mplt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{o}{*}\PY{n}{shp}\PY{p}{,} \PY{n}{constrained\PYZus{}layout}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}               \PY{n}{fig}\PY{p}{,} \PY{n}{pax} \PY{o}{=} \PY{n}{mplt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{o}{*}\PY{n}{shp}\PY{p}{,} \PY{n}{dpi}\PY{o}{=}\PY{n}{dpi}\PY{p}{,} \PY{n}{constrained\PYZus{}layout}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{k}{if} \PY{n+nb}{isinstance}\PY{p}{(}\PY{n}{pax}\PY{p}{,}\PY{n}{np}\PY{o}{.}\PY{n}{ndarray}\PY{p}{)}\PY{p}{:}
            \PY{k}{if} \PY{n}{pax}\PY{o}{.}\PY{n}{ndim} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}    \PY{n}{ax\PYZus{}} \PY{o}{=} \PY{n}{pax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
            \PY{k}{else}\PY{p}{:}               \PY{n}{ax\PYZus{}} \PY{o}{=} \PY{n}{pax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{]}
        \PY{k}{else}\PY{p}{:}
            \PY{n}{ax\PYZus{}} \PY{o}{=} \PY{n}{pax}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{ax\PYZus{}}\PY{p}{,} \PY{n}{pax} \PY{o}{=} \PY{n}{ax}\PY{p}{,} \PY{k+kc}{None}
    \PY{k}{if} \PY{n}{index} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
        \PY{n}{index} \PY{o}{=} \PY{n}{dat}\PY{o}{.}\PY{n}{index}
    \PY{k}{if} \PY{n}{one} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
        \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{dat}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,}\PY{n}{one}\PY{p}{]}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mf}{0.6}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                 \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{v}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{markersize}\PY{o}{=}\PY{l+m+mi}{6}\PY{p}{,} \PY{n}{fillstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{none}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n+nb}{next}\PY{p}{(}\PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{\PYZus{}get\PYZus{}lines}\PY{o}{.}\PY{n}{prop\PYZus{}cycler}\PY{p}{)}
    \PY{k}{if} \PY{n}{versus} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
        \PY{n}{versus} \PY{o}{=} \PY{n}{dat}\PY{o}{.}\PY{n}{columns}
        \PY{k}{try}\PY{p}{:}    \PY{n}{versus}\PY{o}{.}\PY{n}{remote}\PY{p}{(}\PY{n}{one}\PY{p}{)}
        \PY{k}{except}\PY{p}{:} \PY{k}{pass}
    \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{dat}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,}\PY{n}{versus}\PY{p}{]}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{None}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fillstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{none}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{n}{xlabel}\PY{p}{)}\PY{p}{,} \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{n}{ylabel}\PY{p}{)}
    \PY{k}{if} \PY{n}{grid} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{False}\PY{p}{:}       \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{linewidth}\PY{o}{=}\PY{n}{grid}\PY{p}{)}
    \PY{k}{if} \PY{n}{xrottick} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{False}\PY{p}{:}   \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{tick\PYZus{}params}\PY{p}{(}\PY{n}{axis} \PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{labelrotation}\PY{o}{=}\PY{n}{xrottick}\PY{p}{)}
    \PY{k}{if} \PY{n}{locator} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}     \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}major\PYZus{}locator}\PY{p}{(}\PY{n}{locator}\PY{p}{)}
    \PY{k}{if} \PY{n}{formatter} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}   \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{xaxis}\PY{o}{.}\PY{n}{set\PYZus{}major\PYZus{}formatter}\PY{p}{(}\PY{n}{formatter}\PY{p}{)}
    \PY{k}{if} \PY{n}{legend} \PY{o+ow}{is} \PY{k+kc}{None}\PY{p}{:}
        \PY{n}{legend} \PY{o}{=} \PY{p}{[}\PY{n}{one}\PY{p}{]}
        \PY{n}{legend}\PY{o}{.}\PY{n}{extend}\PY{p}{(}\PY{n}{versus}\PY{p}{)}
    \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{legend}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{small}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{n}{title} \PY{o+ow}{not} \PY{o+ow}{in} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}  \PY{n}{ax\PYZus{}}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{title}\PY{p}{,}  \PY{n}{fontsize}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{medium}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{n}{suptitle} \PY{o+ow}{not} \PY{o+ow}{in} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}       
        \PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{n}{suptitle}\PY{p}{,}  \PY{n}{fontsize}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{medium}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{n}{pax} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
        \PY{k}{return} \PY{n}{fig}\PY{p}{,} \PY{n}{pax}
\end{Verbatim}
\end{tcolorbox}

    Again, let's see quickly how this works in practice on a dummy example:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{44}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{ts} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randn}\PY{p}{(}\PY{n}{ndays}\PY{p}{,} \PY{n}{nyears}\PY{p}{)}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{n}{idx\PYZus{}timeline}\PY{p}{,} \PY{n}{columns}\PY{o}{=}\PY{n}{years}\PY{p}{)}
\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{ts}\PY{p}{,}\PY{n}{index}\PY{o}{=}\PY{n+nb}{slice}\PY{p}{(}\PY{n}{dstartref}\PY{p}{,}\PY{n}{dendref}\PY{p}{)}\PY{p}{,} \PY{n}{one}\PY{o}{=}\PY{n}{YEAR}\PY{p}{,} \PY{n}{versus}\PY{o}{=}\PY{n}{years\PYZus{}exc}\PY{p}{,} \PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.5}\PY{p}{,}
               \PY{n}{suptitle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}DUMMY\PYZhy{} another great graph \PYZhy{}DUMMY\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{44}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(<Figure size 600x400 with 1 Axes>,
 <matplotlib.axes.\_subplots.AxesSubplot at 0x1176a6650>)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_91_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    and let's use it to represent the temporal evolution of the different
time series for the available years:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{45}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{dailydeaths}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{,}
               \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 2 (a): Daily deaths for all municipalities in the data set}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{45}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(<Figure size 840x560 with 1 Axes>,
 <matplotlib.axes.\_subplots.AxesSubplot at 0x117740fd0>)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_93_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Following, we also create the timeseries of cumulated counts:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{46}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{cumdailydeaths} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{cumdailydeaths}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{46}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
            2015  2016  2017  2018  2019  2020
2000-01-01   585   507   656   657   534   513
2000-01-02  1202  1036  1417  1325  1121  1084
2000-01-03  1810  1582  2137  1920  1684  1673
2000-01-04  2431  2143  2870  2548  2211  2211
2000-01-05  3075  2663  3636  3219  2745  2756
\end{Verbatim}
\end{tcolorbox}
        
    and display it:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{47}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{cumdailydeaths}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{,}
               \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cumulative death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 2 (b): Cumulative deaths for all municipalities in the data set}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{47}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(<Figure size 840x560 with 1 Axes>,
 <matplotlib.axes.\_subplots.AxesSubplot at 0x11773fbd0>)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_97_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figure-3---age-distribution-of-total-deaths-in-the-period-15-21-march}{%
\subsection{Figure 3 - Age distribution of total deaths in the period
15-21
March}\label{figure-3---age-distribution-of-total-deaths-in-the-period-15-21-march}}

    First we set the period of interest:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{48}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dstart} \PY{o}{=} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{0315}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}   
\PY{n}{week} \PY{o}{=} \PY{n}{dstart}\PY{o}{.}\PY{n}{isocalendar}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\PY{n}{dend} \PY{o}{=} \PY{n}{dstart} \PY{o}{+} \PY{n}{timedelta}\PY{p}{(}\PY{l+m+mi}{6}\PY{p}{)} \PY{c+c1}{\PYZsh{} ddays[\PYZhy{}1] }
\PY{n}{ddays} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}02d}\PY{l+s+si}{\PYZpc{}02d}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{d}\PY{o}{.}\PY{n}{month}\PY{p}{,}\PY{n}{d}\PY{o}{.}\PY{n}{day}\PY{p}{)} \PY{k}{for} \PY{n}{d} \PY{o+ow}{in} \PY{p}{[}\PY{n}{dstart} \PY{o}{+} \PY{n}{timedelta}\PY{p}{(}\PY{n}{i}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{]}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

    We will use the specific field with class ages in the dataset. That's
also where the metadata information comes handy:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{49}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{AGE} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{age}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field of age classes: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{AGE}\PY{p}{)}
\PY{n}{FORMATTER} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{age}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{values}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} range of age classes: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{FORMATTER}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
- field of age classes: \textcolor{ansi-blue-intense}{CL\_ETA}
- range of age classes: \textcolor{ansi-blue-intense}{\{'0': '0', '1': '1-4', '2': '5-9', '3': '10-14',
'4': '15-19', '5': '20-24', '6': '25-29', '7': '30-34', '8': '35-39', '9':
'40-44', '10': '45-49', '11': '50-54', '12': '55-59', '13': '60-64', '14':
'65-69', '15': '70-74', '16': '75-79', '17': '80-84', '18': '85-89', '19':
'90-94', '20': '95-99', '21': '100+'\}}
    \end{Verbatim}

    For this illustration, we will create a dictionary of dataframes indexed
by gender: `t', `f' and `m'. We then proceed like for the previous
dataset \texttt{dailydeaths}, simply grouping by date and age class,
then \emph{resp.} summing the `t', `f' and `m' counts of deaths per year
(\emph{resp.}, ``TOTAL\_**'', ``F\_**'' and ``M\_**'') over all other
remaining fields (\emph{e.g.}, cities):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{50}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{ageofdeaths} \PY{o}{=} \PY{n+nb}{dict}\PY{o}{.}\PY{n}{fromkeys}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{f}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\PY{k}{for} \PY{n}{k} \PY{o+ow}{in} \PY{n}{ageofdeaths}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{deaths} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
    \PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{:}
        \PY{n}{COL} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{k}\PY{p}{,}\PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{)}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
        \PY{n}{d} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{p}{[}\PY{n}{AGE}\PY{p}{,}\PY{n}{DAY}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{n}{COL}\PY{p}{]}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k}{if} \PY{n}{leapday} \PY{o}{\PYZgt{}}\PY{o}{=} \PY{n}{dstart} \PY{o+ow}{and} \PY{n}{leapday} \PY{o}{\PYZlt{}}\PY{o}{=} \PY{n}{dend}\PY{p}{:}
            \PY{c+c1}{\PYZsh{} well... we should do something to be truly generic here... next time!}
            \PY{k}{pass}
        \PY{n}{deaths}\PY{p}{[}\PY{n}{y}\PY{p}{]} \PY{o}{=} \PY{n}{d}\PY{p}{[}\PY{n}{d}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{get\PYZus{}level\PYZus{}values}\PY{p}{(}\PY{n}{DAY}\PY{p}{)}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{ddays}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{AGE}\PY{p}{)}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ageofdeaths}\PY{o}{.}\PY{n}{update}\PY{p}{(}\PY{p}{\PYZob{}}\PY{n}{k}\PY{p}{:} \PY{n}{deaths}\PY{p}{\PYZcb{}}\PY{p}{)}
\PY{n}{ageofdeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{f}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{50}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
        2015  2016  2017  2018  2019  2020
CL\_ETA
0          1     5     1     1     5     0
1          1     0     2     0     0     0
2          0     0     0     1     0     0
3          0     0     0     0     0     0
4          0     0     0     0     1     2
\end{Verbatim}
\end{tcolorbox}
        
    We then represent together the series for the different years:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{51}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plot\PYZus{}one}\PY{p}{(}\PY{n}{ageofdeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,}
                   \PY{n}{marker} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{v}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{,}
                   \PY{n}{xlabel} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{age group}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ylabel} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{death total counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                   \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 3: Age distribution of total deaths in the period [}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{, }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{] (week \PYZsh{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{)}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}}
                       \PY{p}{(}\PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{dstart}\PY{p}{)}\PY{p}{,} \PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{dend}\PY{p}{)}\PY{p}{,} \PY{n}{week}\PY{p}{)}\PY{p}{,}
                   \PY{n}{xticks} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{FORMATTER}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{xticklabels} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n}{FORMATTER}\PY{o}{.}\PY{n}{values}\PY{p}{(}\PY{p}{)}\PY{p}{)}
                  \PY{p}{)}

\PY{n+nb}{next}\PY{p}{(}\PY{n}{ax}\PY{o}{.}\PY{n}{\PYZus{}get\PYZus{}lines}\PY{o}{.}\PY{n}{prop\PYZus{}cycler}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ageofdeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{,}
        \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{markersize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{None}\PY{l+s+s1}{\PYZsq{}}
       \PY{p}{)}

\PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{years}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} 
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{51}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x11769ea50>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_106_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figure-4---relative-increment-of-2020-over-baseline-in-15-21-march-per-age-group}{%
\subsection{Figure 4 - Relative increment of 2020 over baseline in
15-21 March per age
group}\label{figure-4---relative-increment-of-2020-over-baseline-in-15-21-march-per-age-group}}

    The previously generated dataset \texttt{ageofdeaths} is used to
relative increment of 2020 over baseline in 15-21 March per age group:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{52}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{for} \PY{n}{k} \PY{o+ow}{in} \PY{n}{ageofdeaths}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{deaths} \PY{o}{=} \PY{n}{ageofdeaths}\PY{p}{[}\PY{n}{k}\PY{p}{]}
    \PY{n}{deaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{base}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{deaths}\PY{p}{[}\PY{n}{years\PYZus{}exc}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{deaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rinc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{deaths}\PY{p}{[}\PY{n}{YEAR}\PY{p}{]}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{n}{deaths}\PY{o}{.}\PY{n}{base}\PY{p}{)}\PY{o}{.}\PY{n}{div}\PY{p}{(}\PY{n}{deaths}\PY{o}{.}\PY{n}{base}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    We define the period of interest:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{53}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{astart}\PY{p}{,} \PY{n}{aend} \PY{o}{=} \PY{l+m+mi}{11}\PY{p}{,} \PY{n+nb}{max}\PY{p}{(}\PY{n+nb}{map}\PY{p}{(}\PY{n+nb}{int}\PY{p}{,}\PY{n+nb}{list}\PY{p}{(}\PY{n}{FORMATTER}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{rages}\PY{p}{,} \PY{n}{sages} \PY{o}{=} \PY{n+nb}{range}\PY{p}{(}\PY{n}{astart}\PY{p}{,} \PY{n}{aend}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{,} \PY{n+nb}{slice}\PY{p}{(}\PY{n}{astart}\PY{p}{,} \PY{n}{aend}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Age ranges considered in }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{65+}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{[}\PY{n}{FORMATTER}\PY{p}{[}\PY{n+nb}{str}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{p}{]} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{rages}\PY{p}{]}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Age ranges considered in '65+': \textbf{['50-54', '55-59', '60-64', '65-69',
'70-74', '75-79', '80-84', '85-89', '90-94', '95-99', '100+']}
    \end{Verbatim}

    that we use then for generating the figure:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{54}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{func\PYZus{}formater}\PY{p}{(}\PY{n}{val}\PY{p}{,} \PY{n}{pos}\PY{p}{)}\PY{p}{:}
    \PY{k}{try}\PY{p}{:}        \PY{k}{return} \PY{n}{FORMATTER}\PY{p}{[}\PY{n+nb}{str}\PY{p}{(}\PY{n+nb}{int}\PY{p}{(}\PY{n}{val}\PY{p}{)}\PY{p}{)}\PY{p}{]}
    \PY{k}{except}\PY{p}{:}     \PY{k}{return} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}

\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plot\PYZus{}one}\PY{p}{(}\PY{n}{ageofdeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{index} \PY{o}{=} \PY{n}{sages}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rinc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                   \PY{n}{marker} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{*}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{None}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                   \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.2}\PY{p}{,}
                   \PY{n}{xlabel} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{age class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ylabel} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relative increment over baseline}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m+f}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                   \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 4: Relative increment of }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ over baseline in the period [}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{, }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{] per age group}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}}
                        \PY{p}{(}\PY{n}{YEAR}\PY{p}{,} \PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{dstart}\PY{p}{)}\PY{p}{,} \PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{dend}\PY{p}{)}\PY{p}{)}\PY{p}{,}   
                   \PY{n}{formatter} \PY{o}{=} \PY{n}{FuncFormatter}\PY{p}{(}\PY{n}{func\PYZus{}formater}\PY{p}{)}\PY{p}{,} \PY{n}{locator} \PY{o}{=} \PY{n}{IndexLocator}\PY{p}{(}\PY{n}{base}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{offset}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
                  \PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ageofdeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{f}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{sages}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rinc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{markersize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{None}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{female}\PY{l+s+s1}{\PYZsq{}}
       \PY{p}{)}

\PY{n}{ax}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ageofdeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{sages}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rinc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}
        \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{D}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{markersize}\PY{o}{=}\PY{l+m+mi}{3}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{None}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{male}\PY{l+s+s1}{\PYZsq{}}
       \PY{p}{)}

\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{]}\PY{p}{)} \PY{c+c1}{\PYZsh{} hard\PYZhy{}coded like in the figure... sorry}
\PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{54}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x117723210>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_113_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figure-5---empirical-cumulative-distribution-of-excess-deaths-in-15-21-march-2020-per-age-group}{%
\subsection{Figure 5 - Empirical cumulative distribution of excess
deaths in 15-21 March 2020 per age
group}\label{figure-5---empirical-cumulative-distribution-of-excess-deaths-in-15-21-march-2020-per-age-group}}

    We compute the empirical cumulative distribution of excess deaths in
15-21 March 2020 per age group:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{55}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{incdeaths} \PY{o}{=} \PY{n}{ageofdeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{row}\PY{p}{:} \PY{n}{row}\PY{p}{[}\PY{n}{YEAR}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{row}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{base}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{cumdeaths} \PY{o}{=} \PY{n}{incdeaths}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{skipna} \PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    then plotting the empirical cumulative distribution of excess deaths in
the considered period:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{56}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plot\PYZus{}one}\PY{p}{(}\PY{n}{cumdeaths}\PY{o}{/}\PY{n+nb}{max}\PY{p}{(}\PY{n}{cumdeaths}\PY{p}{)}\PY{p}{,} \PY{n}{index} \PY{o}{=} \PY{n}{sages}\PY{p}{,} 
         \PY{n}{marker} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{o}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.2}\PY{p}{,}
         \PY{n}{xlabel} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{age class}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}  \PY{n}{ylabel} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{fraction of excess deaths}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m+f}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
         \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 5: Empirical cumulative distribution of excess deaths in the period [}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{, }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{/}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{] per age group}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} 
             \PY{p}{(}\PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{dstart}\PY{p}{)}\PY{p}{,} \PY{o}{*}\PY{n}{get\PYZus{}daymonth}\PY{p}{(}\PY{n}{dend}\PY{p}{)}\PY{p}{)}\PY{p}{,} 
         \PY{n}{formatter} \PY{o}{=} \PY{n}{FuncFormatter}\PY{p}{(}\PY{n}{func\PYZus{}formater}\PY{p}{)}\PY{p}{,} \PY{n}{locator} \PY{o}{=} \PY{n}{IndexLocator}\PY{p}{(}\PY{n}{base}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{offset}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{56}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(<Figure size 980x560 with 1 Axes>,
 <matplotlib.axes.\_subplots.AxesSubplot at 0x1177a4cd0>)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_118_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figure-6---daily-and-cumulated-deaths-of-males-aged-65}{%
\subsection{Figure 6 - Daily and cumulated deaths of males aged
65+}\label{figure-6---daily-and-cumulated-deaths-of-males-aged-65}}

    Given the age classes considered above (range of ages \texttt{rages}),
we extrac the daily deaths for the male population (hence looking at
``M\_**'' field) over 65 similarly to what we have done for
\texttt{dailydeaths}, just introducing a filter of the input data:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{57}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{:}
    \PY{n}{MCOL} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
    \PY{n}{dailydeaths\PYZus{}m65}\PY{p}{[}\PY{n}{y}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{n}{data}\PY{p}{[}\PY{n}{AGE}\PY{p}{]}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{rages}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{DAY}\PY{p}{)}\PY{p}{[}\PY{n}{MCOL}\PY{p}{]}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{o+ow}{not} \PY{n}{calendar}\PY{o}{.}\PY{n}{isleap}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{:}
        \PY{n}{yloc} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{columns}\PY{o}{.}\PY{n}{get\PYZus{}loc}\PY{p}{(}\PY{n}{y}\PY{p}{)}
        \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{p}{,}\PY{n}{yloc}\PY{p}{]} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{yloc}\PY{p}{]}
\PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{to\PYZus{}series}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{ge}\PY{p}{:} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{ge}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{dailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{reindex}\PY{p}{(}\PY{n}{idx\PYZus{}timeline}\PY{p}{,} \PY{n}{fill\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)} 
\end{Verbatim}
\end{tcolorbox}

    and then render the data:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{58}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{locator} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DayLocator}\PY{p}{(}\PY{n}{bymonthday}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{15}\PY{p}{]}\PY{p}{)} \PY{c+c1}{\PYZsh{} mdates.WeekdayLocator(interval=2)}
\PY{n}{formatter} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DateFormatter}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{dailydeaths\PYZus{}m65}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{,} 
               \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 6 (a): Daily total deaths (male 65+, total)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}            
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{58}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(<Figure size 840x560 with 1 Axes>,
 <matplotlib.axes.\_subplots.AxesSubplot at 0x1176d4f50>)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_123_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Using \texttt{dailydeaths\_m65}, it is then straightforward to compute
and represent the cumulated deaths:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{59}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{cumdailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}

\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{cumdailydeaths\PYZus{}m65}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{grid} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{,}
               \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cumulative death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
               \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 6 (b): Daily cumulative deaths (male 65+, total)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{59}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(<Figure size 840x560 with 1 Axes>,
 <matplotlib.axes.\_subplots.AxesSubplot at 0x117666550>)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_125_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figure-7---total-deaths-in-the-period-1-21-march-per-individual-municipalities}{%
\subsection{Figure 7 - Total deaths in the period 1-21 March per
individual
municipalities}\label{figure-7---total-deaths-in-the-period-1-21-march-per-individual-municipalities}}

    We introduce (now only) a new field in the original dataset in the form
of a reference date (in the leap year \texttt{YREF}) as a way to handle
the time series (where the year used in the index is actually
irrelevant, only the day/month information is of use):

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{60}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dstart}\PY{p}{,} \PY{n}{dend} \PY{o}{=} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{0301}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}\PY{p}{,} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{0321}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}
\PY{n}{data}\PY{o}{.}\PY{n}{insert}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GE\PYZus{}DATE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{data}\PY{p}{[}\PY{n}{DAY}\PY{p}{]}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{row}\PY{p}{:} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{row}\PY{p}{,} \PY{n}{YREF}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n}{data}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{60}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
     GE\_DATE  REG  PROV NOME\_REGIONE NOME\_PROVINCIA NOME\_COMUNE COD\_PROVCOM  \textbackslash{}
0 2000-01-02    1     1     Piemonte         Torino       Agliè      001001
1 2000-01-04    1     1     Piemonte         Torino       Agliè      001001
2 2000-01-05    1     1     Piemonte         Torino       Agliè      001001
3 2000-01-06    1     1     Piemonte         Torino       Agliè      001001
4 2000-01-06    1     1     Piemonte         Torino       Agliè      001001

   CL\_ETA    GE  MASCHI\_15  {\ldots}  FEMMINE\_17  FEMMINE\_18  FEMMINE\_19  \textbackslash{}
0      17  0102          0  {\ldots}           0           1           0
1      18  0104          0  {\ldots}           0           0           0
2      18  0105          0  {\ldots}           0           0           0
3      17  0106          1  {\ldots}           0           0           0
4      18  0106          0  {\ldots}           0           0           0

   FEMMINE\_20  TOTALE\_15  TOTALE\_16  TOTALE\_17  TOTALE\_18  TOTALE\_19  \textbackslash{}
0           0          0          0          0          1          0
1           0          0          1          0          0          0
2           0          0          0          0          0          0
3           0          1          0          0          0          0
4           0          0          0          0          1          0

   TOTALE\_20
0          0
1          0
2          1
3          0
4          0

[5 rows x 27 columns]
\end{Verbatim}
\end{tcolorbox}
        
    Because we look now at cities/municipalities individually, we will be
examining the following fields:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{61}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{CITY\PYZus{}CODE} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{city\PYZus{}code}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field of city/municipality codes: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{CITY\PYZus{}CODE}\PY{p}{)}
\PY{n}{PROV\PYZus{}CODE} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{prov\PYZus{}code}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field of province codes: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{PROV\PYZus{}CODE}\PY{p}{)}
\PY{n}{PROVINCE} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{province}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{\PYZhy{} field of province names: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[94m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n}{PROVINCE}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
- field of city/municipality codes: \textcolor{ansi-blue-intense}{COD\_PROVCOM}
- field of province codes: \textcolor{ansi-blue-intense}{PROV}
- field of province names: \textcolor{ansi-blue-intense}{NOME\_PROVINCIA}
    \end{Verbatim}

    Grouping by city/municipality enables us to actually estimate the sum of
total deaths in the period considered (between \texttt{dstart} and
\texttt{dend}). We also introduce the baseline figure for each
city/municipality as the maximum number of deaths over the previous
years':

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{62}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{citydeaths} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{:}
    \PY{n}{TCOL} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
    \PY{n}{citydeaths}\PY{p}{[}\PY{n}{y}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{n}{data}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GE\PYZus{}DATE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{between}\PY{p}{(}\PY{n}{dstart}\PY{p}{,} \PY{n}{dend}\PY{p}{,} \PY{n}{inclusive}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{p}{]}   \PYZbs{}
        \PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{CITY\PYZus{}CODE}\PY{p}{)}\PY{p}{[}\PY{n}{TCOL}\PY{p}{]}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{citydeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{base}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{citydeaths}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{years\PYZus{}exc}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{citydeaths}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{62}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
             2015  2016  2017  2018  2019  2020  base
COD\_PROVCOM
001001          1     3     1     3     3     7     3
001006          2     1     2     3     2     3     3
001013          5    10     9     5     4     5    10
001020          3     1     1     4     1     6     4
001024         16    10     9    17    18    27    18
\end{Verbatim}
\end{tcolorbox}
        
    It is easy to operate over all cities present in the dataset:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{63}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{cities} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{[}\PY{n}{CITY}\PY{p}{,} \PY{n}{CITY\PYZus{}CODE}\PY{p}{,} \PY{n}{PROVINCE}\PY{p}{,} \PY{n}{PROV\PYZus{}CODE}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{drop\PYZus{}duplicates}\PY{p}{(}\PY{p}{)}
\PY{k}{assert} \PY{n+nb}{len}\PY{p}{(}\PY{n}{cities}\PY{p}{)} \PY{o}{==} \PY{n+nb}{len}\PY{p}{(}\PY{n}{comuni}\PY{p}{)} \PY{c+c1}{\PYZsh{} remember: that was data[CITY].unique()}
\PY{n}{cities}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{63}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
           NOME\_COMUNE COD\_PROVCOM NOME\_PROVINCIA  PROV
0                Agliè      001001         Torino     1
203             Almese      001006         Torino     1
748          Avigliana      001013         Torino     1
1197         Banchette      001020         Torino     1
1391          Beinasco      001024         Torino     1
2286         Bosconero      001033         Torino     1
2637            Bruino      001038         Torino     1
3102  Buttigliera Alta      001045         Torino     1
4141        Carmagnola      001059         Torino     1
5038     Castellamonte      001066         Torino     1
\end{Verbatim}
\end{tcolorbox}
        
    but instead, we select, like in the study, only a bunch of them for
annotation on the graph:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{64}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{comuni} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Albino}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bergamo}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Brescia}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Codogno}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Crema}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
          \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Milano}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Nembro}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Parma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Piacenza}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{San Giovanni Bianco}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{comunitable} \PY{o}{=} \PY{n}{cities}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{cities}\PY{p}{[}\PY{n}{CITY}\PY{p}{]}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{comuni}\PY{p}{)}\PY{p}{]}
\PY{n}{comunitable}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{comunitable}\PY{p}{[}\PY{n}{CITY\PYZus{}CODE}\PY{p}{]}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{comunitable}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{64}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                     NOME\_COMUNE COD\_PROVCOM NOME\_PROVINCIA  PROV
COD\_PROVCOM
015146                    Milano      015146         Milano    15
016004                    Albino      016004        Bergamo    16
016024                   Bergamo      016024        Bergamo    16
016144                    Nembro      016144        Bergamo    16
016188       San Giovanni Bianco      016188        Bergamo    16
017029                   Brescia      017029        Brescia    17
019035                     Crema      019035        Cremona    19
033032                  Piacenza      033032       Piacenza    33
034027                     Parma      034027          Parma    34
098019                   Codogno      098019           Lodi    98
\end{Verbatim}
\end{tcolorbox}
        
    and we display everything together:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{65}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{mplt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{dpi}\PY{o}{=}\PY{n}{\PYZus{}DPI\PYZus{}}\PY{p}{)}
\PY{n}{citydeaths}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{loglog}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}  \PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{base}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{YEAR}\PY{p}{,} \PY{c+c1}{\PYZsh{} kind=\PYZsq{}scatter\PYZsq{},}
                \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{None}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{s}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fillstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{none}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}
               \PY{p}{)}

\PY{n}{xlim}\PY{p}{,} \PY{n}{ylim} \PY{o}{=} \PY{n}{ax}\PY{o}{.}\PY{n}{get\PYZus{}xlim}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{ax}\PY{o}{.}\PY{n}{get\PYZus{}ylim}\PY{p}{(}\PY{p}{)}
\PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{c} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pink}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{:}    
    \PY{n}{ax}\PY{o}{.}\PY{n}{loglog}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{i} \PY{o}{*} \PY{n}{x}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y=}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{if} \PY{n}{i}\PY{o}{==}\PY{l+m+mi}{1} \PY{k}{else} \PY{n+nb}{str}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{n}{c}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{n}{xlim}\PY{p}{)}\PY{p}{,} \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{n}{ylim}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,} \PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{both}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dotted}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k}{for} \PY{n}{index} \PY{o+ow}{in} \PY{n}{comunitable}\PY{o}{.}\PY{n}{index}\PY{p}{:}
    \PY{n}{xpos}\PY{p}{,} \PY{n}{ypos} \PY{o}{=} \PY{n}{citydeaths}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{base}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{citydeaths}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,}\PY{n}{YEAR}\PY{p}{]}
    \PY{n}{r} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{random}\PY{p}{(}\PY{p}{)} \PY{o}{+}\PY{l+m+mi}{1}
    \PY{n}{ax}\PY{o}{.}\PY{n}{annotate}\PY{p}{(}\PY{n}{comunitable}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,}\PY{n}{CITY}\PY{p}{]}\PY{p}{,} 
                \PY{p}{(}\PY{n}{xpos}\PY{p}{,} \PY{n}{ypos}\PY{p}{)}\PY{p}{,} 
                \PY{n}{xytext}\PY{o}{=}\PY{p}{(}\PY{n}{xpos}\PY{o}{+}\PY{n}{r}\PY{o}{*}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{log10}\PY{p}{(}\PY{n}{xpos}\PY{p}{)}\PY{p}{,} \PY{n}{ypos}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{log10}\PY{p}{(}\PY{n}{ypos}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}  
                \PY{n}{arrowprops}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{arrowstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZgt{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} 
                \PY{n}{size}\PY{o}{=}\PY{l+m+mi}{9}\PY{p}{,} \PY{n}{ha}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{center}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{baseline}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{deaths in }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ (selected comuni)}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{YEAR}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 7: Total deaths in the period }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ \PYZhy{} }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ per individual municipalities}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} 
             \PY{p}{(}\PY{n}{Datetime}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{n}{dstart}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{Datetime}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{n}{dend}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}\PY{p}{,}  \PY{n}{fontsize}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{medium}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
\PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{65}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x103584fd0>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_138_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We also propose to spatially represent the relative increment of deaths
with respect to the baseline. Besides computing the actual increment, we
also retrieve the \texttt{CITY\_CODE} index (\emph{i.e.} `COD\_PROVCOM')
and insert it as a column that we rename `PRO\_COM\_T':

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{66}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{citydeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rinc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{citydeaths}\PY{p}{[}\PY{n}{YEAR}\PY{p}{]}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{n}{citydeaths}\PY{o}{.}\PY{n}{base}\PY{p}{)}\PY{o}{.}\PY{n}{div}\PY{p}{(}\PY{n}{citydeaths}\PY{o}{.}\PY{n}{base}\PY{p}{)}
\PY{n}{citydeaths}\PY{p}{[}\PY{n}{PRO\PYZus{}COM\PYZus{}T}\PY{p}{]} \PY{o}{=} \PY{n}{citydeaths}\PY{o}{.}\PY{n}{index}
\PY{n}{citydeaths}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{66}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
             2015  2016  2017  2018  2019  2020  base      rinc PRO\_COM\_T
COD\_PROVCOM
001001          1     3     1     3     3     7     3  1.333333    001001
001006          2     1     2     3     2     3     3  0.000000    001006
001013          5    10     9     5     4     5    10 -0.500000    001013
001020          3     1     1     4     1     6     4  0.500000    001020
001024         16    10     9    17    18    27    18  0.500000    001024
\end{Verbatim}
\end{tcolorbox}
        
    The `PRO\_COM\_T' variable is actually used to `left join'
(\texttt{merge}) the \texttt{citydeaths} data together with the
geographical data \texttt{geodata} on city vectorial representation:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{67}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{geodata} \PY{o}{=} \PY{n}{geodata}\PY{o}{.}\PY{n}{merge}\PY{p}{(}\PY{n}{citydeaths}\PY{p}{,} \PY{n}{on}\PY{o}{=}\PY{n}{PRO\PYZus{}COM\PYZus{}T}\PY{p}{)}
\PY{n}{geodata}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{67}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
   COD\_RIP  COD\_REG  COD\_PROV  COD\_CM  COD\_UTS  PRO\_COM PRO\_COM\_T  \textbackslash{}
0        1        1         1     201      201     1006    001006
1        1        1         1     201      201     1020    001020
2        1        1         1     201      201     1066    001066
3        1        1         1     201      201     1024    001024
4        1        1         1     201      201     1139    001139

                 COMUNE COMUNE\_A  CC\_UTS  {\ldots}     SHAPE\_LEN  \textbackslash{}
0                Almese     None       0  {\ldots}  17058.439037
1             Banchette     None       0  {\ldots}  13861.181642
2         Castellamonte     None       0  {\ldots}  56627.197389
3              Beinasco     None       0  {\ldots}  18927.661943
4  Luserna San Giovanni     None       0  {\ldots}  31182.577534

                                            geometry  2015 2016  2017  2018  \textbackslash{}
0  POLYGON ((376934.962 4999073.854, 376960.555 4{\ldots}     2    1     2     3
1  MULTIPOLYGON (((410556.045 5035845.088, 410737{\ldots}     3    1     1     4
2  MULTIPOLYGON (((399851.593 5035334.590, 399858{\ldots}     6   10     6     3
3  POLYGON ((389377.696 4987362.417, 389538.013 4{\ldots}    16   10     9    17
4  POLYGON ((362241.646 4966621.595, 362247.927 4{\ldots}     9    7    12     9

   2019  2020  base      rinc
0     2     3     3  0.000000
1     1     6     4  0.500000
2     9     9    10 -0.100000
3    18    27    18  0.500000
4    12    11    12 -0.083333

[5 rows x 22 columns]
\end{Verbatim}
\end{tcolorbox}
        
    and we can represent it here:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{68}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{f}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{mplt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{16}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}\PY{p}{)}
\PY{n}{geodata}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{column}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rinc}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{legend}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}axis\PYZus{}off}\PY{p}{(}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 7.5: Relative increment over selected cities/municipalities (comuni)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{mplt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_144_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figures-8---12-daily-and-cumulative-deaths-over-individual-cities}{%
\subsection{Figures 8 - 12: Daily and cumulative deaths over
individual
cities}\label{figures-8---12-daily-and-cumulative-deaths-over-individual-cities}}

    Let's pick a city among those analysed in the study:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{69}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fign} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Codogno}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{8}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Nembro}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{9}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Orzinuovi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Brescia}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{11}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bergamo}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{12}
       \PY{p}{\PYZcb{}}
\PY{n}{comune} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Codogno}\PY{l+s+s1}{\PYZsq{}} \PY{c+c1}{\PYZsh{} \PYZsq{}Nembro\PYZsq{} \PYZsh{} \PYZsq{}Orzinuovi\PYZsq{} \PYZsh{} \PYZsq{}Brescia\PYZsq{} \PYZsh{} \PYZsq{}Bergamo\PYZsq{}}
\PY{n}{comune\PYZus{}code} \PY{o}{=} \PY{n}{cities}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{cities}\PY{p}{[}\PY{n}{CITY}\PY{p}{]}\PY{o}{==}\PY{n}{comune}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{CITY\PYZus{}CODE}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n}{provincia} \PY{o}{=} \PY{n}{cities}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{cities}\PY{p}{[}\PY{n}{CITY}\PY{p}{]}\PY{o}{==}\PY{n}{comune}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{PROVINCE}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Analysing the }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{comune di}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m in }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{provincia di}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m (\PYZsh{}}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m)}\PY{l+s+s2}{\PYZdq{}} 
      \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{comune}\PY{p}{,}\PY{n}{provincia}\PY{p}{,}\PY{n+nb}{int}\PY{p}{(}\PY{n}{comune\PYZus{}code}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Analysing the 'comune di' \textbf{Codogno} in 'provincia di' \textbf{Lodi}
(\#\textbf{98019})
    \end{Verbatim}

    Grouping by date (\texttt{DAY}, \emph{i.e.} `GE') the data over the
\texttt{comune} and aggregating the totals for the different years is
what we need:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{70}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{TCOLS} \PY{o}{=} \PY{p}{[}\PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{]}
\PY{n}{dailydeaths} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{n}{data}\PY{p}{[}\PY{n}{CITY}\PY{p}{]}\PY{o}{==}\PY{n}{comune}\PY{p}{]}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{DAY}\PY{p}{)}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{p}{\PYZob{}}\PY{n}{t}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{TCOLS}\PY{p}{\PYZcb{}}\PY{p}{)}                  

\PY{n}{dailydeaths}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{Index}\PY{p}{(}\PY{n}{dailydeaths}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{to\PYZus{}series}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{ge}\PY{p}{:} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{ge}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{,} 
                      \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{dailydeaths}\PY{o}{.}\PY{n}{sort\PYZus{}index}\PY{p}{(}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{dailydeaths} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{reindex}\PY{p}{(}\PY{n}{idx\PYZus{}timeline}\PY{p}{,} \PY{n}{method}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pad}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{rename}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{\PYZob{}}\PY{n}{t}\PY{p}{:}\PY{n+nb}{int}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{20}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}}\PY{k}{t}[\PYZhy{}2:]) for t in TCOLS\PYZcb{})
\end{Verbatim}
\end{tcolorbox}

    Let's display the total daily deaths for the selected city:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{71}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{locator} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DayLocator}\PY{p}{(}\PY{n}{bymonthday}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{15}\PY{p}{]}\PY{p}{)} \PY{c+c1}{\PYZsh{} mdates.WeekdayLocator(interval=2)}
\PY{n}{formatter} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DateFormatter}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{dailydeaths}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
               \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,}
               \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ (}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{) \PYZhy{} Daily deaths (all)}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{fign}\PY{p}{[}\PY{n}{comune}\PY{p}{]}\PY{p}{,}\PY{n}{comune}\PY{p}{,}\PY{n}{provincia}\PY{p}{)}\PY{p}{,} 
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{71}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(<Figure size 840x560 with 1 Axes>,
 <matplotlib.axes.\_subplots.AxesSubplot at 0x1177f1a50>)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_151_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    as well as the cumulative deaths:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{72}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{cumdailydeaths} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}

\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{cumdailydeaths}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
               \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cumulative death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,}
               \PY{n}{title} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ (}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{) \PYZhy{} Daily cumulative deaths (all)}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{fign}\PY{p}{[}\PY{n}{comune}\PY{p}{]}\PY{p}{,}\PY{n}{comune}\PY{p}{,}\PY{n}{provincia}\PY{p}{)}\PY{p}{,} 
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{72}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
(<Figure size 840x560 with 1 Axes>,
 <matplotlib.axes.\_subplots.AxesSubplot at 0x11785db50>)
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_153_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Similarly, we can process the data regarding the male population of
65y.o. and over in Codogno:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{73}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{MCOLS} \PY{o}{=} \PY{p}{[}\PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{]}

\PY{n}{dailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{p}{(}\PY{n}{data}\PY{p}{[}\PY{n}{CITY}\PY{p}{]}\PY{o}{==}\PY{n}{comune}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{data}\PY{p}{[}\PY{n}{AGE}\PY{p}{]}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{rages}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{DAY}\PY{p}{)}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{p}{\PYZob{}}\PY{n}{t}\PY{p}{:}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}} \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{MCOLS}\PY{p}{\PYZcb{}}\PY{p}{)}                  
\PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{Index}\PY{p}{(}\PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{to\PYZus{}series}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{ge}\PY{p}{:} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{ge}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}\PY{p}{)}\PY{p}{)}\PY{p}{,} 
                          \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{sort\PYZus{}index}\PY{p}{(}\PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{dailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{reindex}\PY{p}{(}\PY{n}{idx\PYZus{}timeline}\PY{p}{)}\PY{o}{.}\PY{n}{rename}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{\PYZob{}}\PY{n}{m}\PY{p}{:}\PY{n+nb}{int}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{20}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{m}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{)} \PY{k}{for} \PY{n}{m} \PY{o+ow}{in} \PY{n}{MCOLS}\PY{p}{\PYZcb{}}\PY{p}{)}

\PY{n}{cumdailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{dailydeaths\PYZus{}m65}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{shp} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}
                         \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,} 
                         \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
                        \PY{p}{)}

\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{cumdailydeaths\PYZus{}m65}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{fig} \PY{o}{=} \PY{n}{fig}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
               \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cumulative death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,} 
               \PY{n}{suptitle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{: }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ (}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{) \PYZhy{} Daily and daily cumulative deaths (male 65+)}\PY{l+s+s1}{\PYZsq{}} 
                   \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{fign}\PY{p}{[}\PY{n}{comune}\PY{p}{]}\PY{p}{,}\PY{n}{comune}\PY{p}{,}\PY{n}{provincia}\PY{p}{)}\PY{p}{,} 
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_155_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figure-13---total-deaths-in-the-week-15-21-march-by-groups-of-municipalities-within-the-same-province}{%
\subsection{Figure 13 - Total deaths in the week 15-21 March by
groups of municipalities within the same
province}\label{figure-13---total-deaths-in-the-week-15-21-march-by-groups-of-municipalities-within-the-same-province}}

    We look at statistics for groups of municipalities and consider the
following timeline and `province' entities:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{74}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dstart}\PY{p}{,} \PY{n}{dend} \PY{o}{=} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{0315}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}\PY{p}{,} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{0321}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}

\PY{n}{provinces} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{p}{[}\PY{n}{PROVINCE}\PY{p}{,} \PY{n}{PROV\PYZus{}CODE}\PY{p}{]}\PY{p}{]}\PY{o}{.}\PY{n}{drop\PYZus{}duplicates}\PY{p}{(}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of provinces represented in the dataset: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{len}\PY{p}{(}\PY{n}{provinces}\PY{p}{)}\PY{p}{)}
\PY{n}{provinces}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Number of provinces represented in the dataset: \textbf{103}
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{74}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                     NOME\_PROVINCIA  PROV
0                            Torino     1
27679                      Vercelli     2
31916                        Novara     3
38546                         Cuneo     4
50379                          Asti     5
55125                   Alessandria     6
65073  Valle d'Aosta/Vallée d'Aoste     7
68042                       Imperia     8
71875                        Savona     9
78709                        Genova    10
\end{Verbatim}
\end{tcolorbox}
        
    Similarly to the analysis run for Figure 7, we analyse total death
counts for different groups of municipalities within the same province.
However, the baseline this time will be the average death count for the
previous years instead of the max:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{75}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{provdeaths} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{:}
    \PY{n}{TCOL} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
    \PY{n}{provdeaths}\PY{p}{[}\PY{n}{y}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{n}{data}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GE\PYZus{}DATE}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{between}\PY{p}{(}\PY{n}{dstart}\PY{p}{,} \PY{n}{dend}\PY{p}{,} \PY{n}{inclusive}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{p}{]}   \PYZbs{}
        \PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{PROV\PYZus{}CODE}\PY{p}{)}\PY{p}{[}\PY{n}{TCOL}\PY{p}{]}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{provdeaths}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{base}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{provdeaths}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{years\PYZus{}exc}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{k}{assert} \PY{n+nb}{len}\PY{p}{(}\PY{n}{provinces}\PY{p}{)} \PY{o}{==} \PY{n+nb}{len}\PY{p}{(}\PY{n}{provdeaths}\PY{p}{)}
\PY{n}{provdeaths}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{75}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
      2015  2016  2017  2018  2019  2020  base
PROV
1       64    78    69    71    88   116  74.0
2       18    16    17    11    18    37  16.0
3       47    47    54    35    57   108  48.0
4       42    44    41    45    52    68  44.8
5       28    31    24    24    26    32  26.6
\end{Verbatim}
\end{tcolorbox}
        
    Actually, we will keep only those provinces that registered 10+ death
events over the considered period in 2020:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{76}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{provdeaths}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{n}{provdeaths}\PY{p}{[}\PY{n}{provdeaths}\PY{p}{[}\PY{n}{YEAR}\PY{p}{]}\PY{o}{\PYZlt{}}\PY{l+m+mi}{10}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Number of provinces that recorded 10+ deaths during the considered period: }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m}\PY{l+s+s2}{\PYZdq{}} 
      \PY{o}{\PYZpc{}} \PY{n+nb}{len}\PY{p}{(}\PY{n}{provdeaths}\PY{p}{)}\PY{p}{)}
\PY{n}{provdeaths}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Number of provinces that recorded 10+ deaths during the considered period:
\textbf{84}
    \end{Verbatim}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{76}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
      2015  2016  2017  2018  2019  2020  base
PROV
1       64    78    69    71    88   116  74.0
2       18    16    17    11    18    37  16.0
3       47    47    54    35    57   108  48.0
4       42    44    41    45    52    68  44.8
5       28    31    24    24    26    32  26.6
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{77}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{province} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Piacenza}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cremona}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Brescia}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bergamo}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Milano}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{provtable} \PY{o}{=} \PY{n}{provinces}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{provinces}\PY{p}{[}\PY{n}{PROVINCE}\PY{p}{]}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{province}\PY{p}{)}\PY{p}{]}
\PY{n}{provtable}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{provtable}\PY{p}{[}\PY{n}{PROV\PYZus{}CODE}\PY{p}{]}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{provtable}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{77}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
     NOME\_PROVINCIA  PROV
PROV
15           Milano    15
16          Bergamo    16
17          Brescia    17
19          Cremona    19
33         Piacenza    33
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{78}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{mplt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{n}{dpi}\PY{o}{=}\PY{n}{\PYZus{}DPI\PYZus{}}\PY{p}{)}
\PY{n}{provdeaths}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{loglog}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,}  \PY{n}{x}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{base}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{y}\PY{o}{=}\PY{n}{YEAR}\PY{p}{,} \PY{c+c1}{\PYZsh{} kind=\PYZsq{}scatter\PYZsq{},}
                \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{None}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{s}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fillstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{none}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}
               \PY{p}{)}

\PY{n}{xlim}\PY{p}{,} \PY{n}{ylim} \PY{o}{=} \PY{n}{ax}\PY{o}{.}\PY{n}{get\PYZus{}xlim}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{ax}\PY{o}{.}\PY{n}{get\PYZus{}ylim}\PY{p}{(}\PY{p}{)}
\PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{4}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{)}
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{c} \PY{o+ow}{in} \PY{n+nb}{zip}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{]}\PY{p}{,} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{purple}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{k}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pink}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{:}    
    \PY{n}{ax}\PY{o}{.}\PY{n}{loglog}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{i} \PY{o}{*} \PY{n}{x}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{y=}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}} \PY{k}{if} \PY{n}{i}\PY{o}{==}\PY{l+m+mi}{1} \PY{k}{else} \PY{n+nb}{str}\PY{p}{(}\PY{n}{i}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{n}{c}
             \PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlim}\PY{p}{(}\PY{n}{xlim}\PY{p}{)}\PY{p}{,} \PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylim}\PY{p}{(}\PY{n}{ylim}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{n}{linewidth}\PY{o}{=}\PY{l+m+mf}{0.3}\PY{p}{,} \PY{n}{which}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{both}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dotted}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k}{for} \PY{n}{index} \PY{o+ow}{in} \PY{n}{provtable}\PY{o}{.}\PY{n}{index}\PY{p}{:}
    \PY{n}{xpos}\PY{p}{,} \PY{n}{ypos} \PY{o}{=} \PY{n}{provdeaths}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{base}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{provdeaths}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,}\PY{n}{YEAR}\PY{p}{]}
    \PY{n}{r} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{random}\PY{p}{(}\PY{p}{)} \PY{o}{+}\PY{l+m+mi}{1}
    \PY{n}{ax}\PY{o}{.}\PY{n}{annotate}\PY{p}{(}\PY{n}{provtable}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{,}\PY{n}{PROVINCE}\PY{p}{]}\PY{p}{,} 
                \PY{p}{(}\PY{n}{xpos}\PY{p}{,} \PY{n}{ypos}\PY{p}{)}\PY{p}{,} 
                \PY{n}{xytext}\PY{o}{=}\PY{p}{(}\PY{n}{xpos}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{log10}\PY{p}{(}\PY{n}{xpos}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.4}\PY{p}{)}\PY{p}{,} \PY{n}{ypos}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{l+m+mi}{10}\PY{o}{*}\PY{o}{*}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{log10}\PY{p}{(}\PY{n}{ypos}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{,}  
                \PY{n}{arrowprops}\PY{o}{=}\PY{n+nb}{dict}\PY{p}{(}\PY{n}{arrowstyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZgt{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} 
                \PY{n}{size}\PY{o}{=}\PY{l+m+mi}{9}\PY{p}{,} \PY{n}{ha}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{center}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{baseline}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{deaths in }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{YEAR}\PY{p}{)}
\PY{n}{ax}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure 13: Total deaths in the period }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ \PYZhy{} }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ by groups of municipalities within the same province}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} 
             \PY{p}{(}\PY{n}{Datetime}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{n}{dstart}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,} \PY{n}{Datetime}\PY{o}{.}\PY{n}{datetime}\PY{p}{(}\PY{n}{dend}\PY{p}{,} \PY{n}{fmt}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}\PY{p}{,}  \PY{n}{fontsize}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{medium}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{,}
\PY{n}{ax}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{78}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x1178ac850>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_164_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{figures-14---16-daily-and-cumulative-deaths-over-individual-provinces}{%
\subsection{Figures 14 - 16: Daily and cumulative deaths over
individual
provinces}\label{figures-14---16-daily-and-cumulative-deaths-over-individual-provinces}}

    As we did for figures 8-12, we select this time a province represented
in the dataset:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{79}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fign} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bergamo}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{14}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Lodi}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{15}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Parma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mi}{16}\PY{p}{\PYZcb{}}
\PY{n}{provincia} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bergamo}\PY{l+s+s1}{\PYZsq{}} \PY{c+c1}{\PYZsh{} \PYZsq{}Lodi\PYZsq{} \PYZsh{} \PYZsq{}Parma\PYZsq{} }
\PY{n}{provincia\PYZus{}code} \PY{o}{=} \PY{n}{cities}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{cities}\PY{p}{[}\PY{n}{PROVINCE}\PY{p}{]}\PY{o}{==}\PY{n}{provincia}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{n}{PROV\PYZus{}CODE}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Analysing the }\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{provincia di}\PY{l+s+s2}{\PYZsq{}}\PY{l+s+s2}{ }\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m (\PYZsh{}}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[1m}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+se}{\PYZbs{}033}\PY{l+s+s2}{[0m)}\PY{l+s+s2}{\PYZdq{}} 
      \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{provincia}\PY{p}{,}\PY{n+nb}{int}\PY{p}{(}\PY{n}{provincia\PYZus{}code}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Analysing the 'provincia di' \textbf{Bergamo} (\#\textbf{16})
    \end{Verbatim}

    and we run a similar `analysis' to actually report the total daily death
counts and daily cumulative death counts:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{80}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dailydeaths} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{:}
    \PY{n}{TCOL} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
    \PY{n}{dailydeaths}\PY{p}{[}\PY{n}{y}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{n}{data}\PY{p}{[}\PY{n}{PROV\PYZus{}CODE}\PY{p}{]}\PY{o}{==}\PY{n}{provincia\PYZus{}code}\PY{p}{]}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{DAY}\PY{p}{)}\PY{p}{[}\PY{n}{TCOL}\PY{p}{]}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{o+ow}{not} \PY{n}{calendar}\PY{o}{.}\PY{n}{isleap}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{:}
        \PY{n}{yloc} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{columns}\PY{o}{.}\PY{n}{get\PYZus{}loc}\PY{p}{(}\PY{n}{y}\PY{p}{)}
        \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{p}{,}\PY{n}{yloc}\PY{p}{]} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{yloc}\PY{p}{]}
\PY{n}{dailydeaths}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{dailydeaths}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{to\PYZus{}series}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{ge}\PY{p}{:} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{ge}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{dailydeaths} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{reindex}\PY{p}{(}\PY{n}{idx\PYZus{}timeline}\PY{p}{,} \PY{n}{fill\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}       

\PY{n}{cumdailydeaths} \PY{o}{=} \PY{n}{dailydeaths}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}

\PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DayLocator}\PY{p}{(}\PY{n}{bymonthday}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{15}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{mdates}\PY{o}{.}\PY{n}{DateFormatter}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{dailydeaths}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{shp} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}
                         \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,}
                         \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
                        \PY{p}{)}

\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{cumdailydeaths}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{fig} \PY{o}{=} \PY{n}{fig}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
               \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cumulative death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,}
               \PY{n}{suptitle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{: Daily deaths and cumulative deaths (all) \PYZhy{} Province of }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}}
                   \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{fign}\PY{p}{[}\PY{n}{provincia}\PY{p}{]}\PY{p}{,}\PY{n}{provincia}\PY{p}{)}\PY{p}{,}
               \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}
              \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_169_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \emph{ibid} for total daily death counts and daily cumulative death
counts when considering the male population of 65 y.o. and over:

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{81}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{dailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{y} \PY{o+ow}{in} \PY{n}{years}\PY{p}{:}
    \PY{n}{MCOL} \PY{o}{=} \PY{n}{dIT}\PY{o}{.}\PY{n}{meta}\PY{o}{.}\PY{n}{get}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{m\PYZus{}}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n+nb}{str}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{:}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
    \PY{n}{dailydeaths\PYZus{}m65}\PY{p}{[}\PY{n}{y}\PY{p}{]} \PY{o}{=} \PY{n}{data}\PY{p}{[}\PY{p}{(}\PY{n}{data}\PY{p}{[}\PY{n}{PROV\PYZus{}CODE}\PY{p}{]}\PY{o}{==}\PY{n}{provincia\PYZus{}code}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{data}\PY{p}{[}\PY{n}{AGE}\PY{p}{]}\PY{o}{.}\PY{n}{isin}\PY{p}{(}\PY{n}{rages}\PY{p}{)}\PY{p}{)}\PY{p}{]}\PY{o}{.}\PY{n}{groupby}\PY{p}{(}\PY{n}{DAY}\PY{p}{)}\PY{p}{[}\PY{n}{MCOL}\PY{p}{]}\PY{o}{.}\PY{n}{agg}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sum}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{k}{if} \PY{o+ow}{not} \PY{n}{calendar}\PY{o}{.}\PY{n}{isleap}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{:}
        \PY{n}{yloc} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{columns}\PY{o}{.}\PY{n}{get\PYZus{}loc}\PY{p}{(}\PY{n}{y}\PY{p}{)}
        \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{p}{,}\PY{n}{yloc}\PY{p}{]} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n}{ileapday}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{yloc}\PY{p}{]}
\PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{to\PYZus{}series}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{k}{lambda} \PY{n}{ge}\PY{p}{:} \PY{n}{get\PYZus{}datetime}\PY{p}{(}\PY{n}{ge}\PY{p}{,}\PY{n}{YREF}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{dailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{reindex}\PY{p}{(}\PY{n}{idx\PYZus{}timeline}\PY{p}{,} \PY{n}{fill\PYZus{}value}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)} 

\PY{n}{cumdailydeaths\PYZus{}m65} \PY{o}{=} \PY{n}{dailydeaths\PYZus{}m65}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{axis} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{skipna} \PY{o}{=}\PY{k+kc}{True}\PY{p}{)} \PY{c+c1}{\PYZsh{} default}

\PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{mdates}\PY{o}{.}\PY{n}{DayLocator}\PY{p}{(}\PY{n}{bymonthday}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{15}\PY{p}{]}\PY{p}{)}\PY{p}{,} \PY{n}{mdates}\PY{o}{.}\PY{n}{DateFormatter}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+si}{\PYZpc{}d}\PY{l+s+s1}{/}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{dailydeaths\PYZus{}m65}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{shp} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,}
            \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,}
            \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}\PY{p}{)}

\PY{n}{plot\PYZus{}oneversus}\PY{p}{(}\PY{n}{cumdailydeaths\PYZus{}m65}\PY{p}{,} \PY{n}{one} \PY{o}{=} \PY{n}{YEAR}\PY{p}{,} \PY{n}{versus} \PY{o}{=} \PY{n}{years\PYZus{}exc}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{fig} \PY{o}{=} \PY{n}{fig}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}
            \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{cumulative death counts}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{l+m+mf}{0.1}\PY{p}{,} \PY{n}{xrottick} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{45}\PY{p}{,}
            \PY{n}{suptitle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Figure }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{: Daily deaths and cumulative deaths (males 65+) \PYZhy{} Province of }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{\PYZsq{}} 
               \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{fign}\PY{p}{[}\PY{n}{provincia}\PY{p}{]}\PY{p}{,}\PY{n}{provincia}\PY{p}{)}\PY{p}{,}
            \PY{n}{locator} \PY{o}{=} \PY{n}{locator}\PY{p}{,} \PY{n}{formatter} \PY{o}{=} \PY{n}{formatter}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{notebook_A_preliminary_view_at_2020_mortality_data_from_ISTAT_files/01_preliminary_IT_study_171_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    

    % Add a bibliography block to the postdoc
    
    
    
\end{document}
